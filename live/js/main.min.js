CLog={todo:function(e,t){this.dev&&console.log("[TODO] Location: "+e+" ==> Message: "+t)},e:function(e,t){console.log("[ERROR] Location: "+e+" ==> Error: ",t)},catch:function(e,t,n){n=void 0!==n&&n,!this.dev||this.hideCaught&&!n||console.log("[ERROR CAUGHT] Location: "+e+" ==> Error: ",t)},d:function(e,t){this.dev&&console.log("[DEBUG] Location: "+e+" ==> Message: ",t)},v:function(e,t){void 0===t?console.log("[VERBOSE]",e):console.log("[VERBOSE] "+e,t)},n:function(e){console.log("--------------------------- "+e+" ---------------------------")},caller:function(){console.log(arguments.callee.caller.arguments.callee.caller.toString())},dev:!0,hideCaught:!1},Array.prototype.remove=function(){for(var e,t,n=arguments,i=n.length;i&&this.length;)for(e=n[--i];-1!==(t=this.indexOf(e));)this.splice(t,1);return this},Array.prototype.sortNumbers=function(){return this.sort(function(e,t){return e-t}),this},Array.prototype.contains=function(e){return this.indexOf(e)>-1},Date.prototype.getMonthName=function(e){return e=e&&e in Date.locale?e:"en",Date.locale[e].month_names[this.getMonth()]},Date.prototype.getMonthNameShort=function(e){return e=e&&e in Date.locale?e:"en",Date.locale[e].month_names_short[this.getMonth()]},Date.locale={en:{month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],month_names_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}},Date.prototype.addDays=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t},Date.prototype.fixUTCDateOffset=function(){var e=new Date(this.valueOf());return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e};var $=jQuery.noConflict();function clone(e){if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;if(e instanceof Date)var t=new e.constructor;else t=e.constructor();for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e.isActiveClone=null,t[n]=clone(e[n]),delete e.isActiveClone);return t}$(document).ready(function(){NSMain.init(),w3.includeHTML(),NSMain.WindowLoad.webPartsLoaded(function(){NSMain.MiscFunctions.preparePlaceholders(),NSMain.MiscFunctions.adjustShadows(),NSMain.MiscFunctions.updateTitle(NSMain.Constants.pageTitle),NSMain.MiscFunctions.disableSPFormSubmits(),NSItems.init()})}),$(window).on("load",function(){NSMain.Spinner.hide(),NSMain.GrayOut.hideGrayOut(),NSMain.Users.init(),CLog.todo("Filter","Add a date range filter option"),CLog.todo("Search","Add Author and Modified fields to search"),CLog.todo("Search","Add search instructions"),CLog.todo("New Feature","Might want to add a delete function for items, maybe via a right click context menu")}),String.prototype.hashCode=function(){var e,t,n=0;if(0===this.length)return n;for(e=0,t=this.length;e<t;e++)n=(n<<5)-n+this.charCodeAt(e),n|=0;return n},String.prototype.toLowerCaseWithDashes=function(){var e=this;return(e=(e=e.replace(/([a-z])([A-Z])/g,"$1-$2")).replace(/([A-Z])([A-Z][a-z])/g,"$1-$2")).toLowerCase()},String.prototype.removeDashesAndCapitalize=function(){var e=this.split("-");for(i=0;i<e.length;i++)e[i]=e[i].charAt(0).toUpperCase()+e[i].slice(1);return e.join("")},String.prototype.toSentenceCaseWithSpaces=function(){var e=this;return e=(e=e.replace(/([a-z])([A-Z])/g,"$1 $2")).replace(/([A-Z])([A-Z][a-z])/g,"$1 $2")},String.prototype.contains=function(e){return this.toLowerCase().indexOf(e)>=0},function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(jQuery)}(function(e){"use strict";var t;e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement,e.ui&&e.widget||(e.cleanData=(t=e.cleanData,function(n){var i,o,a;for(a=0;null!=n[a];a++){o=n[a];try{(i=e._data(o,"events"))&&i.remove&&e(o).triggerHandler("remove")}catch(n){}}t(n)}));var n=null,i=!1,o=e(window),a=0,s={},r={},l={},c={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,hideOnSecondTrigger:!1,selectableSubMenu:!1,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit",iconLoadingClass:"context-menu-icon-loading"},determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var n=this.offset();n.top+=this.outerHeight(),n.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(n)}},position:function(e,t,n){var i;if(t||n){if("maintain"===t&&"maintain"===n)i=e.$menu.position();else{var a=e.$menu.offsetParent().offset();i={top:n-a.top,left:t-a.left}}var s=o.scrollTop()+o.height(),r=o.scrollLeft()+o.width(),l=e.$menu.outerHeight(),c=e.$menu.outerWidth();i.top+l>s&&(i.top-=l),i.top<0&&(i.top=0),i.left+c>r&&(i.left-=c),i.left<0&&(i.left=0),e.$menu.css(i)}else e.determinePosition.call(this,e.$menu)},positionSubmenu:function(t){if(void 0!==t)if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top-5",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var n={top:-9,left:this.outerWidth()-5};t.css(n)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop,activated:e.noop},callback:null,items:{}},d={timer:null,pageX:null,pageY:null},u={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var i=e(this);if("right"===t.data.trigger&&(t.preventDefault(),t.stopImmediatePropagation()),!("right"!==t.data.trigger&&"demand"!==t.data.trigger&&t.originalEvent||!(void 0===t.mouseButton||!t.data||"left"===t.data.trigger&&0===t.mouseButton||"right"===t.data.trigger&&2===t.mouseButton)||i.hasClass("context-menu-active")||i.hasClass("context-menu-disabled"))){if(n=i,t.data.build){var o=t.data.build(n,t);if(!1===o)return;if(t.data=e.extend(!0,{},c,t.data,o||{}),!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log).call(console,"No items specified to show in contextMenu"),new Error("No Items specified");t.data.$trigger=n,h.create(t.data)}h.show.call(i,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var i=e(this);n&&n.length&&!n.is(i)&&n.data("contextMenu").$menu.trigger("contextmenu:hide"),2===t.button&&(n=i.data("contextMenuActive",!0))},mouseup:function(t){var i=e(this);i.data("contextMenuActive")&&n&&n.length&&n.is(i)&&!i.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),(n=i).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),i.removeData("contextMenuActive")},mouseenter:function(t){var i=e(this),o=e(t.relatedTarget),a=e(document);o.is(".context-menu-list")||o.closest(".context-menu-list").length||n&&n.length||(d.pageX=t.pageX,d.pageY=t.pageY,d.data=t.data,a.on("mousemove.contextMenuShow",u.mousemove),d.timer=setTimeout(function(){d.timer=null,a.off("mousemove.contextMenuShow"),(n=i).trigger(e.Event("contextmenu",{data:d.data,pageX:d.pageX,pageY:d.pageY}))},t.data.delay))},mousemove:function(e){d.pageX=e.pageX,d.pageY=e.pageY},mouseleave:function(t){var n=e(t.relatedTarget);if(!n.is(".context-menu-list")&&!n.closest(".context-menu-list").length){try{clearTimeout(d.timer)}catch(t){}d.timer=null}},layerClick:function(t){var n,i,a=e(this).data("contextMenuRoot"),s=t.button,r=t.pageX,l=t.pageY,c=void 0===r;t.preventDefault(),setTimeout(function(){if(c)null!=a&&null!==a.$menu&&void 0!==a.$menu&&a.$menu.trigger("contextmenu:hide");else{var d,u="left"===a.trigger&&0===s||"right"===a.trigger&&2===s;if(document.elementFromPoint&&a.$layer){if(a.$layer.hide(),(n=document.elementFromPoint(r-o.scrollLeft(),l-o.scrollTop())).isContentEditable){var h=document.createRange(),f=window.getSelection();h.selectNode(n),h.collapse(!0),f.removeAllRanges(),f.addRange(h)}e(n).trigger(t),a.$layer.show()}if(a.hideOnSecondTrigger&&u&&null!==a.$menu&&void 0!==a.$menu)a.$menu.trigger("contextmenu:hide");else{if(a.reposition&&u)if(document.elementFromPoint){if(a.$trigger.is(n))return void a.position.call(a.$trigger,a,r,l)}else if(i=a.$trigger.offset(),d=e(window),i.top+=d.scrollTop(),i.top<=t.pageY&&(i.left+=d.scrollLeft(),i.left<=t.pageX&&(i.bottom=i.top+a.$trigger.outerHeight(),i.bottom>=t.pageY&&(i.right=i.left+a.$trigger.outerWidth(),i.right>=t.pageX))))return void a.position.call(a.$trigger,a,r,l);n&&u&&a.$trigger.one("contextmenu:hidden",function(){e(n).contextMenu({x:r,y:l,button:s})}),null!=a&&null!==a.$menu&&void 0!==a.$menu&&a.$menu.trigger("contextmenu:hide")}}},50)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t={};n&&(t=n.data("contextMenu")||{}),void 0===t.zIndex&&(t.zIndex=0);var i=0,o=function(e){""!==e.style.zIndex?i=e.style.zIndex:null!==e.offsetParent&&void 0!==e.offsetParent?o(e.offsetParent):null!==e.parentElement&&void 0!==e.parentElement&&o(e.parentElement)};if(o(e.target),!(t.$menu&&parseInt(i,10)>parseInt(t.$menu.css("zIndex"),10))){switch(e.keyCode){case 9:case 38:if(u.keyStop(e,t),t.isInput){if(9===e.keyCode&&e.shiftKey)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("prevcommand"));if(38===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault()}else if(9!==e.keyCode||e.shiftKey)return void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("prevcommand"));break;case 40:if(u.keyStop(e,t),!t.isInput)return void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("nextcommand"));if(9===e.keyCode)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("nextcommand"));if(40===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault();break;case 37:if(u.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root")){var a=t.$selected.parent().parent();return t.$selected.trigger("contextmenu:blur"),void(t.$selected=a)}break;case 39:if(u.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;var s=t.$selected.data("contextMenu")||{};if(s.$menu&&t.$selected.hasClass("context-menu-submenu"))return t.$selected=null,s.$selected=null,void s.$menu.trigger("nextcommand");break;case 35:case 36:return t.$selected&&t.$selected.find("input, textarea, select").length?void 0:((t.$selected&&t.$selected.parent()||t.$menu).children(":not(."+t.classNames.disabled+", ."+t.classNames.notSelectable+")")[36===e.keyCode?"first":"last"]().trigger("contextmenu:focus"),void e.preventDefault());case 13:if(u.keyStop(e,t),t.isInput){if(t.$selected&&!t.$selected.is("textarea, select"))return void e.preventDefault();break}return void(void 0!==t.$selected&&null!==t.$selected&&t.$selected.trigger("mouseup"));case 32:case 33:case 34:return void u.keyStop(e,t);case 27:return u.keyStop(e,t),void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("contextmenu:hide"));default:var r=String.fromCharCode(e.keyCode).toUpperCase();if(t.accesskeys&&t.accesskeys[r])return void t.accesskeys[r].$node.trigger(t.accesskeys[r].$menu?"contextmenu:focus":"mouseup")}e.stopPropagation(),void 0!==t.$selected&&null!==t.$selected&&t.$selected.trigger(e)}},prevItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{},i=e(this).data("contextMenuRoot")||{};if(n.$selected){var o=n.$selected;(n=n.$selected.parent().data("contextMenu")||{}).$selected=o}for(var a=n.$menu.children(),s=n.$selected&&n.$selected.prev().length?n.$selected.prev():a.last(),r=s;s.hasClass(i.classNames.disabled)||s.hasClass(i.classNames.notSelectable)||s.is(":hidden");)if((s=s.prev().length?s.prev():a.last()).is(r))return;n.$selected&&u.itemMouseleave.call(n.$selected.get(0),t),u.itemMouseenter.call(s.get(0),t);var l=s.find("input, textarea, select");l.length&&l.focus()},nextItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{},i=e(this).data("contextMenuRoot")||{};if(n.$selected){var o=n.$selected;(n=n.$selected.parent().data("contextMenu")||{}).$selected=o}for(var a=n.$menu.children(),s=n.$selected&&n.$selected.next().length?n.$selected.next():a.first(),r=s;s.hasClass(i.classNames.disabled)||s.hasClass(i.classNames.notSelectable)||s.is(":hidden");)if((s=s.next().length?s.next():a.first()).is(r))return;n.$selected&&u.itemMouseleave.call(n.$selected.get(0),t),u.itemMouseenter.call(s.get(0),t);var l=s.find("input, textarea, select");l.length&&l.focus()},focusInput:function(){var t=e(this).closest(".context-menu-item"),n=t.data(),i=n.contextMenu,o=n.contextMenuRoot;o.$selected=i.$selected=t,o.isInput=i.isInput=!0},blurInput:function(){var t=e(this).closest(".context-menu-item").data(),n=t.contextMenu;t.contextMenuRoot.isInput=n.isInput=!1},menuMouseenter:function(){e(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(t){var n=e(this).data().contextMenuRoot;n.$layer&&n.$layer.is(t.relatedTarget)&&(n.hovering=!1)},itemMouseenter:function(t){var n=e(this),i=n.data(),o=i.contextMenu,a=i.contextMenuRoot;a.hovering=!0,t&&a.$layer&&a.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(o.$menu?o:a).$menu.children("."+a.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur"),n.hasClass(a.classNames.disabled)||n.hasClass(a.classNames.notSelectable)?o.$selected=null:n.trigger("contextmenu:focus")},itemMouseleave:function(t){var n=e(this),i=n.data(),o=i.contextMenu,a=i.contextMenuRoot;if(a!==o&&a.$layer&&a.$layer.is(t.relatedTarget))return void 0!==a.$selected&&null!==a.$selected&&a.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),void(a.$selected=o.$selected=o.$node);o&&o.$menu&&o.$menu.hasClass("context-menu-visible")||n.trigger("contextmenu:blur")},itemClick:function(t){var n,i=e(this),o=i.data(),a=o.contextMenu,s=o.contextMenuRoot,r=o.contextMenuKey;if(!(!a.items[r]||i.is("."+s.classNames.disabled+", .context-menu-separator, ."+s.classNames.notSelectable)||i.is(".context-menu-submenu")&&!1===s.selectableSubMenu)){if(t.preventDefault(),t.stopImmediatePropagation(),e.isFunction(a.callbacks[r])&&Object.prototype.hasOwnProperty.call(a.callbacks,r))n=a.callbacks[r];else{if(!e.isFunction(s.callback))return;n=s.callback}!1!==n.call(s.$trigger,r,s,t)?s.$menu.trigger("contextmenu:hide"):s.$menu.parent().length&&h.update.call(s.$trigger,s)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t,n){var i=e(this).data("contextMenuRoot");h.hide.call(i.$trigger,i,n&&n.force)},focusItem:function(t){t.stopPropagation();var n=e(this),i=n.data(),o=i.contextMenu,a=i.contextMenuRoot;n.hasClass(a.classNames.disabled)||n.hasClass(a.classNames.notSelectable)||(n.addClass([a.classNames.hover,a.classNames.visible].join(" ")).parent().find(".context-menu-item").not(n).removeClass(a.classNames.visible).filter("."+a.classNames.hover).trigger("contextmenu:blur"),o.$selected=a.$selected=n,o&&o.$node&&o.$node.hasClass("context-menu-submenu")&&o.$node.addClass(a.classNames.hover),o.$node&&a.positionSubmenu.call(o.$node,o.$menu))},blurItem:function(t){t.stopPropagation();var n=e(this),i=n.data(),o=i.contextMenu,a=i.contextMenuRoot;o.autoHide&&n.removeClass(a.classNames.visible),n.removeClass(a.classNames.hover),o.$selected=null}},h={show:function(t,i,o){var a=e(this),s={};if(e("#context-menu-layer").trigger("mousedown"),t.$trigger=a,!1!==t.events.show.call(a,t))if(!1!==h.update.call(a,t)){if(t.position.call(a,t,i,o),t.zIndex){var r=t.zIndex;"function"==typeof t.zIndex&&(r=t.zIndex.call(a,t)),s.zIndex=function(e){for(var t=0,n=a;t=Math.max(t,parseInt(n.css("z-index"),10)||0),(n=n.parent())&&n.length&&!(-1<"html body".indexOf(n.prop("nodeName").toLowerCase())););return t}()+r}h.layer.call(t.$menu,t,s.zIndex),t.$menu.find("ul").css("zIndex",s.zIndex+1),t.$menu.css(s)[t.animation.show](t.animation.duration,function(){a.trigger("contextmenu:visible"),h.activated(t),t.events.activated(t)}),a.data("contextMenu",t).addClass("context-menu-active"),e(document).off("keydown.contextMenu").on("keydown.contextMenu",u.key),t.autoHide&&e(document).on("mousemove.contextMenuAutoHide",function(e){var n=a.offset();n.right=n.left+a.outerWidth(),n.bottom=n.top+a.outerHeight(),!t.$layer||t.hovering||e.pageX>=n.left&&e.pageX<=n.right&&e.pageY>=n.top&&e.pageY<=n.bottom||setTimeout(function(){t.hovering||null===t.$menu||void 0===t.$menu||t.$menu.trigger("contextmenu:hide")},50)})}else n=null;else n=null},hide:function(t,i){var o=e(this);if(t||(t=o.data("contextMenu")||{}),i||!t.events||!1!==t.events.hide.call(o,t)){if(o.removeData("contextMenu").removeClass("context-menu-active"),t.$layer){setTimeout((a=t.$layer,function(){a.remove()}),10);try{delete t.$layer}catch(i){t.$layer=null}}var a;n=null,t.$menu.find("."+t.classNames.hover).trigger("contextmenu:blur"),t.$selected=null,t.$menu.find("."+t.classNames.visible).removeClass(t.classNames.visible),e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),t.$menu&&t.$menu[t.animation.hide](t.animation.duration,function(){t.build&&(t.$menu.remove(),e.each(t,function(e){switch(e){case"ns":case"selector":case"build":case"trigger":return!0;default:t[e]=void 0;try{delete t[e]}catch(e){}return!0}})),setTimeout(function(){o.trigger("contextmenu:hidden")},10)})}},create:function(t,n){function i(t){var n=e("<span></span>");if(t._accesskey)t._beforeAccesskey&&n.append(document.createTextNode(t._beforeAccesskey)),e("<span></span>").addClass("context-menu-accesskey").text(t._accesskey).appendTo(n),t._afterAccesskey&&n.append(document.createTextNode(t._afterAccesskey));else if(t.isHtmlName){if(void 0!==t.accesskey)throw new Error("accesskeys are not compatible with HTML names and cannot be used together in the same item");n.html(t.name)}else n.text(t.name);return n}void 0===n&&(n=t),t.$menu=e('<ul class="context-menu-list"></ul>').addClass(t.className||"").data({contextMenu:t,contextMenuRoot:n}),e.each(["callbacks","commands","inputs"],function(e,i){t[i]={},n[i]||(n[i]={})}),n.accesskeys||(n.accesskeys={}),e.each(t.items,function(o,a){var s=e('<li class="context-menu-item"></li>').addClass(a.className||""),r=null,c=null;if(s.on("click",e.noop),"string"!=typeof a&&"cm_separator"!==a.type||(a={type:"cm_seperator"}),a.$node=s.data({contextMenu:t,contextMenuRoot:n,contextMenuKey:o}),void 0!==a.accesskey)for(var d,f=function(e){for(var t,n=e.split(/\s+/),i=[],o=0;t=n[o];o++)t=t.charAt(0).toUpperCase(),i.push(t);return i}(a.accesskey),p=0;d=f[p];p++)if(!n.accesskeys[d]){var m=(n.accesskeys[d]=a).name.match(new RegExp("^(.*?)("+d+")(.*)$","i"));m&&(a._beforeAccesskey=m[1],a._accesskey=m[2],a._afterAccesskey=m[3]);break}if(a.type&&l[a.type])l[a.type].call(s,a,t,n),e.each([t,n],function(n,i){i.commands[o]=a,!e.isFunction(a.callback)||void 0!==i.callbacks[o]&&void 0!==t.type||(i.callbacks[o]=a.callback)});else{switch("cm_seperator"===a.type?s.addClass("context-menu-separator "+n.classNames.notSelectable):"html"===a.type?s.addClass("context-menu-html "+n.classNames.notSelectable):"sub"===a.type||(a.type?(r=e("<label></label>").appendTo(s),i(a).appendTo(r),s.addClass("context-menu-input"),t.hasTypes=!0,e.each([t,n],function(e,t){t.commands[o]=a,t.inputs[o]=a})):a.items&&(a.type="sub")),a.type){case"cm_seperator":break;case"text":c=e('<input type="text" value="1" name="" />').attr("name","context-menu-input-"+o).val(a.value||"").appendTo(r);break;case"textarea":c=e('<textarea name=""></textarea>').attr("name","context-menu-input-"+o).val(a.value||"").appendTo(r),a.height&&c.height(a.height);break;case"checkbox":c=e('<input type="checkbox" value="1" name="" />').attr("name","context-menu-input-"+o).val(a.value||"").prop("checked",!!a.selected).prependTo(r);break;case"radio":c=e('<input type="radio" value="1" name="" />').attr("name","context-menu-input-"+a.radio).val(a.value||"").prop("checked",!!a.selected).prependTo(r);break;case"select":c=e('<select name=""></select>').attr("name","context-menu-input-"+o).appendTo(r),a.options&&(e.each(a.options,function(t,n){e("<option></option>").val(t).text(n).appendTo(c)}),c.val(a.selected));break;case"sub":i(a).appendTo(s),a.appendTo=a.$node,s.data("contextMenu",a).addClass("context-menu-submenu"),a.callback=null,"function"==typeof a.items.then?h.processPromises(a,n,a.items):h.create(a,n);break;case"html":e(a.html).appendTo(s);break;default:e.each([t,n],function(n,i){i.commands[o]=a,!e.isFunction(a.callback)||void 0!==i.callbacks[o]&&void 0!==t.type||(i.callbacks[o]=a.callback)}),i(a).appendTo(s)}a.type&&"sub"!==a.type&&"html"!==a.type&&"cm_seperator"!==a.type&&(c.on("focus",u.focusInput).on("blur",u.blurInput),a.events&&c.on(a.events,t)),a.icon&&(e.isFunction(a.icon)?a._icon=a.icon.call(this,this,s,o,a):"string"==typeof a.icon&&"fa-"===a.icon.substring(0,3)?a._icon=n.classNames.icon+" "+n.classNames.icon+"--fa fa "+a.icon:a._icon=n.classNames.icon+" "+n.classNames.icon+"-"+a.icon,s.addClass(a._icon))}a.$input=c,a.$label=r,s.appendTo(t.$menu),!t.hasTypes&&e.support.eventSelectstart&&s.on("selectstart.disableTextSelect",u.abortevent)}),t.$node||t.$menu.css("display","none").addClass("context-menu-root"),t.$menu.appendTo(t.appendTo||document.body)},resize:function(t,n){var i;t.css({position:"absolute",display:"block"}),t.data("width",(i=t.get(0)).getBoundingClientRect?Math.ceil(i.getBoundingClientRect().width):t.outerWidth()+1),t.css({position:"static",minWidth:"0px",maxWidth:"100000px"}),t.find("> li > ul").each(function(){h.resize(e(this),!0)}),n||t.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return e(this).data("width")})},update:function(t,n){var i=this;void 0===n&&(n=t,h.resize(t.$menu));var o=!1;return t.$menu.children().each(function(){var a,s=e(this),r=s.data("contextMenuKey"),l=t.items[r],c=e.isFunction(l.disabled)&&l.disabled.call(i,r,n)||!0===l.disabled;if((a=e.isFunction(l.visible)?l.visible.call(i,r,n):void 0===l.visible||!0===l.visible)&&(o=!0),s[a?"show":"hide"](),s[c?"addClass":"removeClass"](n.classNames.disabled),e.isFunction(l.icon)&&(s.removeClass(l._icon),l._icon=l.icon.call(this,i,s,r,l),s.addClass(l._icon)),l.type)switch(s.find("input, select, textarea").prop("disabled",c),l.type){case"text":case"textarea":l.$input.val(l.value||"");break;case"checkbox":case"radio":l.$input.val(l.value||"").prop("checked",!!l.selected);break;case"select":l.$input.val((0===l.selected?"0":l.selected)||"")}l.$menu&&h.update.call(i,l,n)&&(o=!0)}),o},layer:function(t,n){var i=t.$layer=e('<div id="context-menu-layer"></div>').css({height:o.height(),width:o.width(),display:"block",position:"fixed","z-index":n,top:0,left:0,opacity:0,filter:"alpha(opacity=0)","background-color":"#000"}).data("contextMenuRoot",t).insertBefore(this).on("contextmenu",u.abortevent).on("mousedown",u.layerClick);return void 0===document.body.style.maxWidth&&i.css({position:"absolute",height:e(document).height()}),i},processPromises:function(e,t,n){function i(e,t,n){void 0===n?(n={error:{name:"No items and no error item",icon:"context-menu-icon context-menu-icon-quit"}},window.console&&(console.error||console.log).call(console,'When you reject a promise, provide an "items" object, equal to normal sub-menu items')):"string"==typeof n&&(n={error:{name:n}}),o(e,t,n)}function o(e,t,n){void 0!==t.$menu&&t.$menu.is(":visible")&&(e.$node.removeClass(t.classNames.iconLoadingClass),e.items=n,h.create(e,t,!0),h.update(e,t),t.positionSubmenu.call(e.$node,e.$menu))}e.$node.addClass(t.classNames.iconLoadingClass),n.then(function(e,t,n){void 0===n&&i(void 0),o(e,t,n)}.bind(this,e,t),i.bind(this,e,t))},activated:function(t){var n=t.$menu,i=n.offset(),o=e(window).height(),a=e(window).scrollTop(),s=n.height();o<s?n.css({height:o+"px","overflow-x":"hidden","overflow-y":"auto",top:a+"px"}):(i.top<a||i.top+s>a+o)&&n.css({top:"0px"})}};function f(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}e.fn.contextMenu=function(t){var n=this,i=t;if(0<this.length)if(void 0===t)this.first().trigger("contextmenu");else if(void 0!==t.x&&void 0!==t.y)this.first().trigger(e.Event("contextmenu",{pageX:t.x,pageY:t.y,mouseButton:t.button}));else if("hide"===t){var o=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;o&&o.trigger("contextmenu:hide")}else"destroy"===t?e.contextMenu("destroy",{context:this}):e.isPlainObject(t)?(t.context=this,e.contextMenu("create",t)):t?this.removeClass("context-menu-disabled"):t||this.addClass("context-menu-disabled");else e.each(r,function(){this.selector===n.selector&&(i.data=this,e.extend(i.data,{trigger:"demand"}))}),u.contextmenu.call(i.target,i);return this},e.contextMenu=function(t,n){"string"!=typeof t&&(n=t,t="create"),"string"==typeof n?n={selector:n}:void 0===n&&(n={});var o=e.extend(!0,{},c,n||{}),l=e(document),d=l,f=!1;switch(o.context&&o.context.length?(d=e(o.context).first(),o.context=d.get(0),f=!e(o.context).is(document)):o.context=document,t){case"update":if(f)h.update(d);else for(var p in r)r.hasOwnProperty(p)&&h.update(r[p]);break;case"create":if(!o.selector)throw new Error("No selector specified");if(o.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className');if(!o.build&&(!o.items||e.isEmptyObject(o.items)))throw new Error("No Items specified");if(a++,o.ns=".contextMenu"+a,f||(s[o.selector]=o.ns),(r[o.ns]=o).trigger||(o.trigger="right"),!i){var m="click"===o.itemClickEvent?"click.contextMenu":"mouseup.contextMenu",g={"contextmenu:focus.contextMenu":u.focusItem,"contextmenu:blur.contextMenu":u.blurItem,"contextmenu.contextMenu":u.abortevent,"mouseenter.contextMenu":u.itemMouseenter,"mouseleave.contextMenu":u.itemMouseleave};g[m]=u.itemClick,l.on({"contextmenu:hide.contextMenu":u.hideMenu,"prevcommand.contextMenu":u.prevItem,"nextcommand.contextMenu":u.nextItem,"contextmenu.contextMenu":u.abortevent,"mouseenter.contextMenu":u.menuMouseenter,"mouseleave.contextMenu":u.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",u.inputClick).on(g,".context-menu-item"),i=!0}switch(d.on("contextmenu"+o.ns,o.selector,o,u.contextmenu),f&&d.on("remove"+o.ns,function(){e(this).contextMenu("destroy")}),o.trigger){case"hover":d.on("mouseenter"+o.ns,o.selector,o,u.mouseenter).on("mouseleave"+o.ns,o.selector,o,u.mouseleave);break;case"left":d.on("click"+o.ns,o.selector,o,u.click);break;case"touchstart":d.on("touchstart"+o.ns,o.selector,o,u.click)}o.build||h.create(o);break;case"destroy":var v;if(f){var y=o.context;e.each(r,function(t,n){if(!n)return!0;if(!e(y).is(n.selector))return!0;(v=e(".context-menu-list").filter(":visible")).length&&v.data().contextMenuRoot.$trigger.is(e(n.context).find(n.selector))&&v.trigger("contextmenu:hide",{force:!0});try{r[n.ns].$menu&&r[n.ns].$menu.remove(),delete r[n.ns]}catch(t){r[n.ns]=null}return e(n.context).off(n.ns),!0})}else if(o.selector){if(s[o.selector]){(v=e(".context-menu-list").filter(":visible")).length&&v.data().contextMenuRoot.$trigger.is(o.selector)&&v.trigger("contextmenu:hide",{force:!0});try{r[s[o.selector]].$menu&&r[s[o.selector]].$menu.remove(),delete r[s[o.selector]]}catch(t){r[s[o.selector]]=null}l.off(s[o.selector])}}else l.off(".contextMenu .contextMenuAutoHide"),e.each(r,function(t,n){e(n.context).off(n.ns)}),s={},r={},a=0,i=!1,e("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||"boolean"==typeof n&&n)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+t+'"')}return this},e.contextMenu.setInputValues=function(t,n){void 0===n&&(n={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=n[e]||"";break;case"checkbox":t.selected=!!n[e];break;case"radio":t.selected=(n[t.radio]||"")===t.value;break;case"select":t.selected=n[e]||""}})},e.contextMenu.getInputValues=function(t,n){return void 0===n&&(n={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":n[e]=t.$input.val();break;case"checkbox":n[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(n[t.radio]=t.value)}}),n},e.contextMenu.fromMenu=function(t){var n={};return function t(n,i,o){return o||(o=0),i.each(function(){var i,a,s=e(this),r=this,l=this.nodeName.toLowerCase();switch("label"===l&&s.find("input, textarea, select").length&&(i=s.text(),l=(r=(s=s.children().first()).get(0)).nodeName.toLowerCase()),l){case"menu":a={name:s.attr("label"),items:{}},o=t(a.items,s.children(),o);break;case"a":case"button":a={name:s.text(),disabled:!!s.attr("disabled"),callback:function(){s.get(0).click()}};break;case"menuitem":case"command":switch(s.attr("type")){case void 0:case"command":case"menuitem":a={name:s.attr("label"),disabled:!!s.attr("disabled"),icon:s.attr("icon"),callback:function(){s.get(0).click()}};break;case"checkbox":a={type:"checkbox",disabled:!!s.attr("disabled"),name:s.attr("label"),selected:!!s.attr("checked")};break;case"radio":a={type:"radio",disabled:!!s.attr("disabled"),name:s.attr("label"),radio:s.attr("radiogroup"),value:s.attr("id"),selected:!!s.attr("checked")};break;default:a=void 0}break;case"hr":a="-------";break;case"input":switch(s.attr("type")){case"text":a={type:"text",name:i||f(r),disabled:!!s.attr("disabled"),value:s.val()};break;case"checkbox":a={type:"checkbox",name:i||f(r),disabled:!!s.attr("disabled"),selected:!!s.attr("checked")};break;case"radio":a={type:"radio",name:i||f(r),disabled:!!s.attr("disabled"),radio:!!s.attr("name"),value:s.val(),selected:!!s.attr("checked")};break;default:a=void 0}break;case"select":a={type:"select",name:i||f(r),disabled:!!s.attr("disabled"),selected:s.val(),options:{}},s.children().each(function(){a.options[this.value]=e(this).text()});break;case"textarea":a={type:"textarea",name:i||f(r),disabled:!!s.attr("disabled"),value:s.val()};break;case"label":break;default:a={type:"html",html:s.clone(!0)}}a&&(n["key"+ ++o]=a)}),o}(n,e(t).children()),n},e.contextMenu.defaults=c,e.contextMenu.types=l,e.contextMenu.handle=u,e.contextMenu.op=h,e.contextMenu.menus=r}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){e.ui=e.ui||{};e.ui.version="1.12.1";!function(){var t,n=Math.max,i=Math.abs,o=/left|center|right/,a=/top|center|bottom/,s=/[\+\-]\d+(\.[\d]+)?%?/,r=/^\w+/,l=/%$/,c=e.fn.position;function d(e,t,n){return[parseFloat(e[0])*(l.test(e[0])?t/100:1),parseFloat(e[1])*(l.test(e[1])?n/100:1)]}function u(t,n){return parseInt(e.css(t,n),10)||0}e.position={scrollbarWidth:function(){if(void 0!==t)return t;var n,i,o=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=o.children()[0];return e("body").append(o),n=a.offsetWidth,o.css("overflow","scroll"),n===(i=a.offsetWidth)&&(i=o[0].clientWidth),o.remove(),t=n-i},getScrollInfo:function(t){var n=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),i=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),o="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth;return{width:"scroll"===i||"auto"===i&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:o?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=e.isWindow(n[0]),o=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:i,isDocument:o,offset:!i&&!o?e(t).offset():{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:n.outerWidth(),height:n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var l,h,f,p,m,g,v,y,b=e(t.of),w=e.position.getWithinInfo(t.within),I=e.position.getScrollInfo(w),x=(t.collision||"flip").split(" "),k={};return g=9===(y=(v=b)[0]).nodeType?{width:v.width(),height:v.height(),offset:{top:0,left:0}}:e.isWindow(y)?{width:v.width(),height:v.height(),offset:{top:v.scrollTop(),left:v.scrollLeft()}}:y.preventDefault?{width:0,height:0,offset:{top:y.pageY,left:y.pageX}}:{width:v.outerWidth(),height:v.outerHeight(),offset:v.offset()},b[0].preventDefault&&(t.at="left top"),h=g.width,f=g.height,p=g.offset,m=e.extend({},p),e.each(["my","at"],function(){var e,n,i=(t[this]||"").split(" ");1===i.length&&(i=o.test(i[0])?i.concat(["center"]):a.test(i[0])?["center"].concat(i):["center","center"]),i[0]=o.test(i[0])?i[0]:"center",i[1]=a.test(i[1])?i[1]:"center",e=s.exec(i[0]),n=s.exec(i[1]),k[this]=[e?e[0]:0,n?n[0]:0],t[this]=[r.exec(i[0])[0],r.exec(i[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===t.at[0]?m.left+=h:"center"===t.at[0]&&(m.left+=h/2),"bottom"===t.at[1]?m.top+=f:"center"===t.at[1]&&(m.top+=f/2),l=d(k.at,h,f),m.left+=l[0],m.top+=l[1],this.each(function(){var o,a,s=e(this),r=s.outerWidth(),c=s.outerHeight(),g=u(this,"marginLeft"),v=u(this,"marginTop"),y=r+g+u(this,"marginRight")+I.width,C=c+v+u(this,"marginBottom")+I.height,D=e.extend({},m),$=d(k.my,s.outerWidth(),s.outerHeight());"right"===t.my[0]?D.left-=r:"center"===t.my[0]&&(D.left-=r/2),"bottom"===t.my[1]?D.top-=c:"center"===t.my[1]&&(D.top-=c/2),D.left+=$[0],D.top+=$[1],o={marginLeft:g,marginTop:v},e.each(["left","top"],function(n,i){e.ui.position[x[n]]&&e.ui.position[x[n]][i](D,{targetWidth:h,targetHeight:f,elemWidth:r,elemHeight:c,collisionPosition:o,collisionWidth:y,collisionHeight:C,offset:[l[0]+$[0],l[1]+$[1]],my:t.my,at:t.at,within:w,elem:s})}),t.using&&(a=function(e){var o=p.left-D.left,a=o+h-r,l=p.top-D.top,d=l+f-c,u={target:{element:b,left:p.left,top:p.top,width:h,height:f},element:{element:s,left:D.left,top:D.top,width:r,height:c},horizontal:a<0?"left":o>0?"right":"center",vertical:d<0?"top":l>0?"bottom":"middle"};h<r&&i(o+a)<h&&(u.horizontal="center"),f<c&&i(l+d)<f&&(u.vertical="middle"),n(i(o),i(a))>n(i(l),i(d))?u.important="horizontal":u.important="vertical",t.using.call(this,e,u)}),s.offset(e.extend(D,{using:a}))})},e.ui.position={fit:{left:function(e,t){var i,o=t.within,a=o.isWindow?o.scrollLeft:o.offset.left,s=o.width,r=e.left-t.collisionPosition.marginLeft,l=a-r,c=r+t.collisionWidth-s-a;t.collisionWidth>s?l>0&&c<=0?(i=e.left+l+t.collisionWidth-s-a,e.left+=l-i):e.left=c>0&&l<=0?a:l>c?a+s-t.collisionWidth:a:l>0?e.left+=l:c>0?e.left-=c:e.left=n(e.left-r,e.left)},top:function(e,t){var i,o=t.within,a=o.isWindow?o.scrollTop:o.offset.top,s=t.within.height,r=e.top-t.collisionPosition.marginTop,l=a-r,c=r+t.collisionHeight-s-a;t.collisionHeight>s?l>0&&c<=0?(i=e.top+l+t.collisionHeight-s-a,e.top+=l-i):e.top=c>0&&l<=0?a:l>c?a+s-t.collisionHeight:a:l>0?e.top+=l:c>0?e.top-=c:e.top=n(e.top-r,e.top)}},flip:{left:function(e,t){var n,o,a=t.within,s=a.offset.left+a.scrollLeft,r=a.width,l=a.isWindow?a.scrollLeft:a.offset.left,c=e.left-t.collisionPosition.marginLeft,d=c-l,u=c+t.collisionWidth-r-l,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,f="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,p=-2*t.offset[0];d<0?((n=e.left+h+f+p+t.collisionWidth-r-s)<0||n<i(d))&&(e.left+=h+f+p):u>0&&((o=e.left-t.collisionPosition.marginLeft+h+f+p-l)>0||i(o)<u)&&(e.left+=h+f+p)},top:function(e,t){var n,o,a=t.within,s=a.offset.top+a.scrollTop,r=a.height,l=a.isWindow?a.scrollTop:a.offset.top,c=e.top-t.collisionPosition.marginTop,d=c-l,u=c+t.collisionHeight-r-l,h="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,p=-2*t.offset[1];d<0?((o=e.top+h+f+p+t.collisionHeight-r-s)<0||o<i(d))&&(e.top+=h+f+p):u>0&&((n=e.top-t.collisionPosition.marginTop+h+f+p-l)>0||i(n)<u)&&(e.top+=h+f+p)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}();e.ui.position}),function(e,t){"use strict";var n;if("object"==typeof exports){try{n=require("moment")}catch(e){}module.exports=t(n)}else"function"==typeof define&&define.amd?define(function(e){try{n=e("moment")}catch(e){}return t(n)}):e.Pikaday=t(e.moment)}(this,function(e){"use strict";var t="function"==typeof e,n=!!window.addEventListener,i=window.document,o=window.setTimeout,a=function(e,t,i,o){n?e.addEventListener(t,i,!!o):e.attachEvent("on"+t,i)},s=function(e,t,i,o){n?e.removeEventListener(t,i,!!o):e.detachEvent("on"+t,i)},r=function(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")},l=function(e,t){r(e,t)||(e.className=""===e.className?t:e.className+" "+t)},c=function(e,t){var n;e.className=(n=(" "+e.className+" ").replace(" "+t+" "," ")).trim?n.trim():n.replace(/^\s+|\s+$/g,"")},d=function(e){return/Array/.test(Object.prototype.toString.call(e))},u=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},h=function(e){var t=e.getDay();return 0===t||6===t},f=function(e,t){return[31,function(e){return e%4==0&&e%100!=0||e%400==0}(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},p=function(e){u(e)&&e.setHours(0,0,0,0)},m=function(e,t){return e.getTime()===t.getTime()},g=function(e,t,n){var i,o;for(i in t)(o=void 0!==e[i])&&"object"==typeof t[i]&&null!==t[i]&&void 0===t[i].nodeName?u(t[i])?n&&(e[i]=new Date(t[i].getTime())):d(t[i])?n&&(e[i]=t[i].slice(0)):e[i]=g({},t[i],n):!n&&o||(e[i]=t[i]);return e},v=function(e,t,n){var o;i.createEvent?((o=i.createEvent("HTMLEvents")).initEvent(t,!0,!1),o=g(o,n),e.dispatchEvent(o)):i.createEventObject&&(o=i.createEventObject(),o=g(o,n),e.fireEvent("on"+t,o))},y=function(e){return e.month<0&&(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),e.month>11&&(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e},b={field:null,bound:void 0,ariaLabel:"Use the arrow keys to pick a date",position:"bottom left",reposition:!0,format:"YYYY-MM-DD",toString:null,parse:null,defaultDate:null,setDefaultDate:!1,firstDay:0,formatStrict:!1,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,pickWholeWeek:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,startRange:null,endRange:null,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,showDaysInNextAndPreviousMonths:!1,enableSelectionDaysInNextAndPreviousMonths:!1,numberOfMonths:1,mainCalendar:"left",container:void 0,blurFieldOnSelect:!0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},theme:null,events:[],onSelect:null,onOpen:null,onClose:null,onDraw:null,keyboardInput:!0},w=function(e,t,n){for(t+=e.firstDay;t>=7;)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},I=function(e){var t=[],n="false";if(e.isEmpty){if(!e.showDaysInNextAndPreviousMonths)return'<td class="is-empty"></td>';t.push("is-outside-current-month"),e.enableSelectionDaysInNextAndPreviousMonths||t.push("is-selection-disabled")}return e.isDisabled&&t.push("is-disabled"),e.isToday&&t.push("is-today"),e.isSelected&&(t.push("is-selected"),n="true"),e.hasEvent&&t.push("has-event"),e.isInRange&&t.push("is-inrange"),e.isStartRange&&t.push("is-startrange"),e.isEndRange&&t.push("is-endrange"),'<td data-day="'+e.day+'" class="'+t.join(" ")+'" aria-selected="'+n+'"><button class="pika-button pika-day" type="button" data-pika-year="'+e.year+'" data-pika-month="'+e.month+'" data-pika-day="'+e.day+'">'+e.day+"</button></td>"},x=function(e,t,n,i){return'<tr class="pika-row'+(n?" pick-whole-week":"")+(i?" is-selected":"")+'">'+(t?e.reverse():e).join("")+"</tr>"},k=function(e,t,n,i,o,a){var s,r,l,c,u,h=e._o,f=n===h.minYear,p=n===h.maxYear,m='<div id="'+a+'" class="pika-title" role="heading" aria-live="assertive">',g=!0,v=!0;for(l=[],s=0;s<12;s++)l.push('<option value="'+(n===o?s-t:12+s-t)+'"'+(s===i?' selected="selected"':"")+(f&&s<h.minMonth||p&&s>h.maxMonth?'disabled="disabled"':"")+">"+h.i18n.months[s]+"</option>");for(c='<div class="pika-label">'+h.i18n.months[i]+'<select class="pika-select pika-select-month" tabindex="-1">'+l.join("")+"</select></div>",d(h.yearRange)?(s=h.yearRange[0],r=h.yearRange[1]+1):(s=n-h.yearRange,r=1+n+h.yearRange),l=[];s<r&&s<=h.maxYear;s++)s>=h.minYear&&l.push('<option value="'+s+'"'+(s===n?' selected="selected"':"")+">"+s+"</option>");return u='<div class="pika-label">'+n+h.yearSuffix+'<select class="pika-select pika-select-year" tabindex="-1">'+l.join("")+"</select></div>",h.showMonthAfterYear?m+=u+c:m+=c+u,f&&(0===i||h.minMonth>=i)&&(g=!1),p&&(11===i||h.maxMonth<=i)&&(v=!1),0===t&&(m+='<button class="pika-prev'+(g?"":" is-disabled")+'" type="button">'+h.i18n.previousMonth+"</button>"),t===e._o.numberOfMonths-1&&(m+='<button class="pika-next'+(v?"":" is-disabled")+'" type="button">'+h.i18n.nextMonth+"</button>"),m+"</div>"},C=function(e,t,n){return'<table cellpadding="0" cellspacing="0" class="pika-table" role="grid" aria-labelledby="'+n+'">'+function(e){var t,n=[];for(e.showWeekNumber&&n.push("<th></th>"),t=0;t<7;t++)n.push('<th scope="col"><abbr title="'+w(e,t)+'">'+w(e,t,!0)+"</abbr></th>");return"<thead><tr>"+(e.isRTL?n.reverse():n).join("")+"</tr></thead>"}(e)+("<tbody>"+t.join("")+"</tbody>")+"</table>"},D=function(s){var l=this,c=l.config(s);l._onMouseDown=function(e){if(l._v){var t=(e=e||window.event).target||e.srcElement;if(t)if(r(t,"is-disabled")||(!r(t,"pika-button")||r(t,"is-empty")||r(t.parentNode,"is-disabled")?r(t,"pika-prev")?l.prevMonth():r(t,"pika-next")&&l.nextMonth():(l.setDate(new Date(t.getAttribute("data-pika-year"),t.getAttribute("data-pika-month"),t.getAttribute("data-pika-day"))),c.bound&&o(function(){l.hide(),c.blurFieldOnSelect&&c.field&&c.field.blur()},100))),r(t,"pika-select"))l._c=!0;else{if(!e.preventDefault)return e.returnValue=!1,!1;e.preventDefault()}}},l._onChange=function(e){var t=(e=e||window.event).target||e.srcElement;t&&(r(t,"pika-select-month")?l.gotoMonth(t.value):r(t,"pika-select-year")&&l.gotoYear(t.value))},l._onKeyChange=function(e){if(e=e||window.event,l.isVisible())switch(e.keyCode){case 13:case 27:c.field&&c.field.blur();break;case 37:e.preventDefault(),l.adjustDate("subtract",1);break;case 38:l.adjustDate("subtract",7);break;case 39:l.adjustDate("add",1);break;case 40:l.adjustDate("add",7)}},l._onInputChange=function(n){var i;n.firedBy!==l&&(i=c.parse?c.parse(c.field.value,c.format):t?(i=e(c.field.value,c.format,c.formatStrict))&&i.isValid()?i.toDate():null:new Date(Date.parse(c.field.value)),u(i)&&l.setDate(i),l._v||l.show())},l._onInputFocus=function(){l.show()},l._onInputClick=function(){l.show()},l._onInputBlur=function(){var e=i.activeElement;do{if(r(e,"pika-single"))return}while(e=e.parentNode);l._c||(l._b=o(function(){l.hide()},50)),l._c=!1},l._onClick=function(e){var t=(e=e||window.event).target||e.srcElement,i=t;if(t){!n&&r(t,"pika-select")&&(t.onchange||(t.setAttribute("onchange","return;"),a(t,"change",l._onChange)));do{if(r(i,"pika-single")||i===c.trigger)return}while(i=i.parentNode);l._v&&t!==c.trigger&&i!==c.trigger&&l.hide()}},l.el=i.createElement("div"),l.el.className="pika-single"+(c.isRTL?" is-rtl":"")+(c.theme?" "+c.theme:""),a(l.el,"mousedown",l._onMouseDown,!0),a(l.el,"touchend",l._onMouseDown,!0),a(l.el,"change",l._onChange),c.keyboardInput&&a(i,"keydown",l._onKeyChange),c.field&&(c.container?c.container.appendChild(l.el):c.bound?i.body.appendChild(l.el):c.field.parentNode.insertBefore(l.el,c.field.nextSibling),a(c.field,"change",l._onInputChange),c.defaultDate||(t&&c.field.value?c.defaultDate=e(c.field.value,c.format).toDate():c.defaultDate=new Date(Date.parse(c.field.value)),c.setDefaultDate=!0));var d=c.defaultDate;u(d)?c.setDefaultDate?l.setDate(d,!0):l.gotoDate(d):l.gotoDate(new Date),c.bound?(this.hide(),l.el.className+=" is-bound",a(c.trigger,"click",l._onInputClick),a(c.trigger,"focus",l._onInputFocus),a(c.trigger,"blur",l._onInputBlur)):this.show()};return D.prototype={config:function(e){this._o||(this._o=g({},b,!0));var t=g(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.theme="string"==typeof t.theme&&t.theme?t.theme:null,t.bound=!!(void 0!==t.bound?t.field&&t.bound:t.field),t.trigger=t.trigger&&t.trigger.nodeName?t.trigger:t.field,t.disableWeekends=!!t.disableWeekends,t.disableDayFn="function"==typeof t.disableDayFn?t.disableDayFn:null;var n=parseInt(t.numberOfMonths,10)||1;if(t.numberOfMonths=n>4?4:n,u(t.minDate)||(t.minDate=!1),u(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&this.setMinDate(t.minDate),t.maxDate&&this.setMaxDate(t.maxDate),d(t.yearRange)){var i=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||i,t.yearRange[1]=parseInt(t.yearRange[1],10)||i}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||b.yearRange,t.yearRange>100&&(t.yearRange=100);return t},toString:function(n){return n=n||this._o.format,u(this._d)?this._o.toString?this._o.toString(this._d,n):t?e(this._d).format(n):this._d.toDateString():""},getMoment:function(){return t?e(this._d):null},setMoment:function(n,i){t&&e.isMoment(n)&&this.setDate(n.toDate(),i)},getDate:function(){return u(this._d)?new Date(this._d.getTime()):null},setDate:function(e,t){if(!e)return this._d=null,this._o.field&&(this._o.field.value="",v(this._o.field,"change",{firedBy:this})),this.draw();if("string"==typeof e&&(e=new Date(Date.parse(e))),u(e)){var n=this._o.minDate,i=this._o.maxDate;u(n)&&e<n?e=n:u(i)&&e>i&&(e=i),this._d=new Date(e.getTime()),p(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),v(this._o.field,"change",{firedBy:this})),t||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(e){var t=!0;if(u(e)){if(this.calendars){var n=new Date(this.calendars[0].year,this.calendars[0].month,1),i=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),o=e.getTime();i.setMonth(i.getMonth()+1),i.setDate(i.getDate()-1),t=o<n.getTime()||i.getTime()<o}t&&(this.calendars=[{month:e.getMonth(),year:e.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()}},adjustDate:function(e,t){var n,i=this.getDate()||new Date,o=24*parseInt(t)*60*60*1e3;"add"===e?n=new Date(i.valueOf()+o):"subtract"===e&&(n=new Date(i.valueOf()-o)),this.setDate(n)},adjustCalendars:function(){this.calendars[0]=y(this.calendars[0]);for(var e=1;e<this._o.numberOfMonths;e++)this.calendars[e]=y({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){e instanceof Date?(p(e),this._o.minDate=e,this._o.minYear=e.getFullYear(),this._o.minMonth=e.getMonth()):(this._o.minDate=b.minDate,this._o.minYear=b.minYear,this._o.minMonth=b.minMonth,this._o.startRange=b.startRange),this.draw()},setMaxDate:function(e){e instanceof Date?(p(e),this._o.maxDate=e,this._o.maxYear=e.getFullYear(),this._o.maxMonth=e.getMonth()):(this._o.maxDate=b.maxDate,this._o.maxYear=b.maxYear,this._o.maxMonth=b.maxMonth,this._o.endRange=b.endRange),this.draw()},setStartRange:function(e){this._o.startRange=e},setEndRange:function(e){this._o.endRange=e},draw:function(e){if(this._v||e){var t,n=this._o,i=n.minYear,a=n.maxYear,s=n.minMonth,r=n.maxMonth,l="";this._y<=i&&(this._y=i,!isNaN(s)&&this._m<s&&(this._m=s)),this._y>=a&&(this._y=a,!isNaN(r)&&this._m>r&&(this._m=r)),t="pika-title-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,2);for(var c=0;c<n.numberOfMonths;c++)l+='<div class="pika-lendar">'+k(this,c,this.calendars[c].year,this.calendars[c].month,this.calendars[0].year,t)+this.render(this.calendars[c].year,this.calendars[c].month,t)+"</div>";this.el.innerHTML=l,n.bound&&"hidden"!==n.field.type&&o(function(){n.trigger.focus()},1),"function"==typeof this._o.onDraw&&this._o.onDraw(this),n.bound&&n.field.setAttribute("aria-label",n.ariaLabel)}},adjustPosition:function(){var e,t,n,o,a,s,r,d,u,h,f,p;if(!this._o.container){if(this.el.style.position="absolute",t=e=this._o.trigger,n=this.el.offsetWidth,o=this.el.offsetHeight,a=window.innerWidth||i.documentElement.clientWidth,s=window.innerHeight||i.documentElement.clientHeight,r=window.pageYOffset||i.body.scrollTop||i.documentElement.scrollTop,f=!0,p=!0,"function"==typeof e.getBoundingClientRect)d=(h=e.getBoundingClientRect()).left+window.pageXOffset,u=h.bottom+window.pageYOffset;else for(d=t.offsetLeft,u=t.offsetTop+t.offsetHeight;t=t.offsetParent;)d+=t.offsetLeft,u+=t.offsetTop;(this._o.reposition&&d+n>a||this._o.position.indexOf("right")>-1&&d-n+e.offsetWidth>0)&&(d=d-n+e.offsetWidth,f=!1),(this._o.reposition&&u+o>s+r||this._o.position.indexOf("top")>-1&&u-o-e.offsetHeight>0)&&(u=u-o-e.offsetHeight,p=!1),this.el.style.left=d+"px",this.el.style.top=u+"px",l(this.el,f?"left-aligned":"right-aligned"),l(this.el,p?"bottom-aligned":"top-aligned"),c(this.el,f?"right-aligned":"left-aligned"),c(this.el,p?"top-aligned":"bottom-aligned")}},render:function(e,t,n){var i=this._o,o=new Date,a=f(e,t),s=new Date(e,t,1).getDay(),r=[],l=[];p(o),i.firstDay>0&&(s-=i.firstDay)<0&&(s+=7);for(var c=0===t?11:t-1,d=11===t?0:t+1,g=0===t?e-1:e,v=11===t?e+1:e,y=f(g,c),b=a+s,w=b;w>7;)w-=7;b+=7-w;for(var k,D,$,T,M=!1,N=0,S=0;N<b;N++){var _=new Date(e,t,N-s+1),L=!!u(this._d)&&m(_,this._d),P=m(_,o),O=-1!==i.events.indexOf(_.toDateString()),A=N<s||N>=a+s,W=N-s+1,R=t,B=e,E=i.startRange&&m(i.startRange,_),F=i.endRange&&m(i.endRange,_),U=i.startRange&&i.endRange&&i.startRange<_&&_<i.endRange;A&&(N<s?(W=y+W,R=c,B=g):(W-=a,R=d,B=v));var H={day:W,month:R,year:B,hasEvent:O,isSelected:L,isToday:P,isDisabled:i.minDate&&_<i.minDate||i.maxDate&&_>i.maxDate||i.disableWeekends&&h(_)||i.disableDayFn&&i.disableDayFn(_),isEmpty:A,isStartRange:E,isEndRange:F,isInRange:U,showDaysInNextAndPreviousMonths:i.showDaysInNextAndPreviousMonths,enableSelectionDaysInNextAndPreviousMonths:i.enableSelectionDaysInNextAndPreviousMonths};i.pickWholeWeek&&L&&(M=!0),l.push(I(H)),7==++S&&(i.showWeekNumber&&l.unshift((k=N-s,D=t,$=e,T=void 0,T=new Date($,0,1),'<td class="pika-week">'+Math.ceil(((new Date($,D,k)-T)/864e5+T.getDay()+1)/7)+"</td>")),r.push(x(l,i.isRTL,i.pickWholeWeek,M)),l=[],S=0,M=!1)}return C(i,r,n)},isVisible:function(){return this._v},show:function(){this.isVisible()||(this._v=!0,this.draw(),c(this.el,"is-hidden"),this._o.bound&&(a(i,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var e=this._v;!1!==e&&(this._o.bound&&s(i,"click",this._onClick),this.el.style.position="static",this.el.style.left="auto",this.el.style.top="auto",l(this.el,"is-hidden"),this._v=!1,void 0!==e&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){var e=this._o;this.hide(),s(this.el,"mousedown",this._onMouseDown,!0),s(this.el,"touchend",this._onMouseDown,!0),s(this.el,"change",this._onChange),e.keyboardInput&&s(i,"keydown",this._onKeyChange),e.field&&(s(e.field,"change",this._onInputChange),e.bound&&(s(e.trigger,"click",this._onInputClick),s(e.trigger,"focus",this._onInputFocus),s(e.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},D}),NSMain=function(){var e={constructor:null,Constants:{},MiscFunctions:{},Toast:{},Spinner:{},GrayOut:{},BlockUI:{},PopupWindow:{},Users:{},WindowLoad:{},init:function(){e.Constants=Constants,e.MiscFunctions=MiscFunctions,e.Toast=Toast.getInstance(e),e.Spinner=Spinner.getInstance(e),e.GrayOut=GrayOut.getInstance(e),e.BlockUI=BlockUI.getInstance(e),e.PopupWindow=PopupWindow.getInstance(e),e.Users=Users.getInstance(e),e.WindowLoad=WindowLoad.getInstance(e)}};return e}(),BlockUI=function(){function e(e){var t=e.Spinner,n=e.GrayOut;this.constructor=null;var i=0;this.block=function(e){void 0!==e&&(i=e,setTimeout(function(){i=0},e)),t.show(),n.showGrayOut()},this.unblock=function(){setTimeout(function(){t.hide(),n.hideGrayOut()},i)}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),Constants={siteUrl:"http://sharepoint.com/SiteName/",pageTitle:"Inventory",itemsListName:"Inventory",auditTrailListName:"InventoryAuditTrail",toastShort:1500,toastMedium:2500,toastLong:4e3,fadeDuration:500,defaultTime:"1900-01-01T00:00:00Z",Ids:{toast:"#toast-wrapper",scrollableTable:".scrollable-table",underlined:".underlined"}},Object.freeze(Constants),MiscFunctions=function(){return{updateTitle:function(e){document.title=e},adjustShadows:function(){$(".shadow").each(function(){var e=$(this);e.is("tr")&&e.find("th").attr("colspan",e.parent().find("tr:first-child th").length)})},preparePlaceholders:function(){var e=$("html").css("font-family");$(function(){$("html").on("focus","[placeholder]",function(){var t=$(this);t.val()===t.attr("placeholder")&&(t.val(""),t.removeClass("placeholder"),t.css("color","#1C4D6F"),t.css("font-family",e))}),$("html").on("blur","[placeholder]",function(){var t=$(this);""===t.val()||t.val()===t.attr("placeholder")?(t.addClass("placeholder"),t.val(t.attr("placeholder")),t.css("color","#aaaaaa"),t.css("font-family",e)):(t.css("color","#1C4D6F"),t.css("font-family",e))})}),$("[placeholder]").blur()},disableSPFormSubmits:function(){$("input[type=submit]").attr("disabled","disabled")},shakeElement:function(e,t){for(var n=20,i=0;i<=10;i++)e.animate({"margin-left":"+="+(n=-n)+"px","margin-right":"-="+n+"px"},50,o);function o(){e.css({"margin-left":"0px"}),e.css({"margin-right":"0px"})}setTimeout(function(){void 0!==t&&t()},500)},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=\/]/g,function(e){return t[e]})},date:function(e){var t=new Date(e),n="N/A";if("Invalid Date"!==t&&!isNaN(t)){var i=(t=t.fixUTCDateOffset()).getDate();n=i<10?"0"+i:i,n+=" "+t.getMonthNameShort()+" ",n+=t.getFullYear()}return n},datetime:function(e){var t=new Date(e),n="N/A";if("Invalid Date"!==t&&!isNaN(t)){var i=t.toLocaleTimeString("en-us",{timeZoneName:"short"}).split(" ")[2];n=String.format("{0:yyyy}",t)+"-",n+=String.format("{0:MM}",t)+"-",n+=String.format("{0:dd}",t)+" ",n+=String.format("{0:T}",t)+" ",n+=i}return n},pikaday:{objects:[],init:function(){var e=this,t={};e.objects=[],$(".datepicker").each(function(){t=new Pikaday({field:$(this).find("input")[0],defaultDate:"DD MMM YYYY",onSelect:function(e){var t=e.getFullYear(),n=e.getMonthNameShort(),i=e.getDate(),o=(i=i<10?"0"+i:i)+" "+n+" "+t;this._o.field.value=o;var a=this._o.field.parentElement.parentElement.id,s=$(this._o.field.parentElement.outerHTML).attr("field-name");$("#"+a).find("td[field-name='"+s+"']").find("input").val(o)}}),e.objects.push(t)})},getObjects:function(){return this.objects}},isDate:function(e){var t=new Date(e);if("Invalid Date"===t||isNaN(t)||4!==t.getFullYear().toString().length){var n=new Date(function(e,t){t=t||"yyyy-mm-dd";var n=e.match(/(\d+)/g),i=0,o={};t.replace(/(yyyy|dd|mm)/g,function(e){o[e]=i++});var a="";try{a=new Date(n[o.yyyy],n[o.mm]-1,n[o.dd])}catch(e){a=!1,CLog.catch("MiscFunctions.parseDate",e)}return a}(e,"dd/mm/yyyy"));return"Invalid Date"!==n&&!isNaN(n)&&4===n.getFullYear().toString().length}return!0},daysInMonth:function(e,t){return new Date(t,e,0).getDate()}}}(),PopupWindow=function(){function e(e){var t=e.Constants,n=e.GrayOut,i=this;i.constructor=null;var o,a=t.fadeDuration,s={};s.Ids={popupWindow:"#popup-window",mainWrapper:"#popup-window-main-content-wrapper",closeButton:"#close-popup-button",title:"#popup-window-title"};var r={closePopupWindowButtonClickListener:function(){$("body").on("click",s.Ids.popupWindow+" "+s.Ids.closeButton,function(e){i.hide()})},closePopupWindowListener:function(){$("body").on("click",function(e){e.target.id===n.id()&&$(s.Ids.popupWindow).is(":visible")&&i.hide()})},init:function(){this.closePopupWindowButtonClickListener(),this.closePopupWindowListener()}};i.show=function(e){o=$(s.Ids.popupWindow),void 0!==e&&""!==e.content&&void 0!==e.content&&(e.title=void 0!==e.title?e.title:"Popup Window",$(s.Ids.mainWrapper).html(e.content),$(s.Ids.title).html(e.title),void 0!==e.width&&(o.css("width",e.width+"vw"),o.css("left",(100-e.width)/2+"vw")),void 0!==e.height&&(o.css("height",e.height+"vh"),o.css("top",(100-e.height)/3+"vh")),o.fadeIn(a),n.showGrayOut(!0))},i.hide=function(){o.fadeOut(a).promise().done(function(){$(s.Ids.mainWrapper).html("")}),n.keepVisible(!1),n.hideGrayOut()},i.isVisible=function(){return(o=$(s.Ids.popupWindow)).is(":visible")},r.init()}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),Toast=function(){function e(e){var t=e.Constants,n=e.MiscFunctions,i=this;i.constructor=null;var o={Ids:{toast:"#toast-wrapper"}},a=t.fadeDuration,s="",r="",l=!1;i.showToast=function(e){s=$(o.Ids.toast),void 0===e&&e.message.length||l||(e.duration=void 0!==e.duration?e.duration:t.toastLong,e.shake=void 0!==e.shake&&e.shake,s.html(e.message),s.fadeIn(a),e.shake&&(l=!0,n.shakeElement(s,function(){l=!1})),clearTimeout(r),0!==e.duration&&(r=setTimeout(function(){i.hideToast(e.callback)},e.duration)))},i.hideToast=function(e){s=$(o.Ids.toast),clearTimeout(r),s.fadeOut(a,function(){s.html(""),void 0!==e&&e()})},i.id=function(){return o.Ids.toast}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),Users=function(){function e(e){e.Constants;var t=this;t.constructor=null;var n="",i="";t.get_currentUserId=function(){$.ajax({url:Constants.siteUrl+"/_api/web/CurrentUser?$select=Id",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(e){n=e.d.Id,t.getUser(n)},error:function(e){CLog.e("Users.get_currentUserId","request failed "+e)}})},t.getCurrentUsername=function(){return i},t.getCurrentUserId=function(){return n},t.getUser=function(e){$.ajax({url:Constants.siteUrl+"/_api/web/getuserbyid("+e+")",method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(e){e.d,i=e.d.Title},error:function(e){CLog.e("Users.get_currentUserId","request failed "+e)}})},t.init=function(){t.get_currentUserId(),t.getCurrentUsername()}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),WindowLoad=function(){function e(e){var t=e.Toast;e.MiscFunctions;this.constructor=null,this.webPartsLoaded=function(e){var n=0,i=setInterval(function(){n++,$(t.id()).length?(clearInterval(i),e()):100===n&&(clearInterval(i),alert("Oops, something went wrong.</br>Please try refreshing page or clearing your browser caches. If that doesn't resolve the issue, please contact your system administrator."))},200)}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),GrayOut=function(){function e(e){this.constructor=null;var t={Ids:{grayOut:"#gray-out-div"}},n=!1;this.showGrayOut=function(e){!0===e&&(n=e),$(t.Ids.grayOut).fadeIn(200)},this.hideGrayOut=function(){n||$(t.Ids.grayOut).fadeOut(200)},this.keepVisible=function(e){n=e},this.id=function(){return t.Ids.grayOut.substr(1)}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),Spinner=function(){function e(e){this.constructor=null;var t={Ids:{spinner:"#spinner"}};this.show=function(){$(t.Ids.spinner).fadeIn(200)},this.hide=function(){$(t.Ids.spinner).fadeOut(200)}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),NSItems=function(){var e={};return e.constructor=null,e.NewItem={},e.ItemUpdates={},e.InventoryTable={},e.Search={},e.AuditTrail={},e.Sort={},e.Filter={},e.DeleteItem={},e.settings={toastDuration:"",fields:["ID","Name","Notebook","StorageAssetID","RackNo","BoxNo","Analyst","Date","Quantity","Notes"]},e.init=function(){e.settings.toastDuration=NSMain.Constants.toastShort,e.AuditTrail=AuditTrail.getInstance(e),e.Search=Search.getInstance(e),e.Sort=Sort.getInstance(e),e.Filter=Filter.getInstance(e),e.InventoryTable=InventoryTable.getInstance(e),e.DeleteItem=DeleteItem.getInstance(e),e.NewItem=NewItem.getInstance(e),e.ItemUpdates=ItemUpdates.getInstance(e),e.Search.solveCircularDependencies({NewItem:e.NewItem,InventoryTable:e.InventoryTable}),e.InventoryTable.solveCircularDependencies({NewItem:e.NewItem,ItemUpdates:e.ItemUpdates,DeleteItem:e.DeleteItem}),e.Sort.solveCircularDependencies({InventoryTable:e.InventoryTable}),e.Filter.solveCircularDependencies({InventoryTable:e.InventoryTable}),NSItems.InventoryTable.populateTable(),NSItems.Search.init(),NSItems.NewItem.init(),NSItems.InventoryTable.init(),NSItems.ItemUpdates.init()},e}(),AuditTrail=function(){function e(e){var t=NSMain.Constants,n=NSMain.PopupWindow,i=NSMain.MiscFunctions,o=NSMain.Users;this.constructor=null;var a="",s={ID:"text",ItemID:"text",Changes:"text",eLN:"text",Created:"datetime",User:"person_lookup"},r={Ids:{auditTrailTable:"#audit-trail-table",auditTrailChangesTd:".audit-trail-changes-td",auditTrailChangesText:".audit-trail-changes-text",newItemTitle:"#new-item-title-text"}};this.getAuditTrail=function(e,o){o=void 0!==o?o:{},a=e;var l="_api/web/lists/getbytitle('"+t.auditTrailListName+"')/items",c="?$select=",d="*&$expand=";for(var u in s)s.hasOwnProperty(u)&&("person_lookup"===s[u]?(d+=u+",",c+=u+"/Title,"):c+=u+",");"*&$expand="!==d?c+=d.slice(0,-1):c=c.slice(0,-1),c+="&$filter=(ItemID eq "+e+")",c+="&$orderby=ID desc";var h={};$.ajax({url:t.siteUrl+l+c,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(e){for(var o in e.d.results)e.d.results.hasOwnProperty(o)&&(h[o]={},h[o].ID=e.d.results[o].ID,h[o].ItemID=e.d.results[o].ItemID,h[o].Changes=JSON.parse(e.d.results[o].Changes),h[o].eLN=e.d.results[o].eLN,h[o].Created=e.d.results[o].Created,h[o].User=e.d.results[o].User.Title);!function(e){var o="<table id='"+r.Ids.auditTrailTable.slice(1)+"' class='"+t.Ids.scrollableTable.slice(1)+"'>";o+="<thead>",o+="<tr>",o+="<th>Version</th>",o+="<th class='"+r.Ids.auditTrailChangesTd.slice(1)+"'>Changes</th>",o+="<th>User</th>",o+="<th>Date</th>",o+="<th>eLN</th>",o+="<th></th>",o+="</tr>",o+="<tr class='shadow'><th></th></tr>",o+="</thead>",o+="<tbody>";var s=Object.keys(e).length;for(var l in e)if(e.hasOwnProperty(l)){var c=e[l].Changes,d=null!==e[l].eLN?e[l].eLN:"N/A";o+="<tr>",o+="<td title='"+--s+"'>",o+="<span>"+s+"</span>",o+="</td>";var u="",h="";for(var f in 0===s&&(u+="<div id='"+r.Ids.newItemTitle.slice(1)+"'>New Item</div>",h+="New item was added with values: "),c)c.hasOwnProperty(f)&&(u+="<div>",u+="<b>"+f+": </b>",0===s?h+=f+": '"+c[f].NewValue+"'; ":(u+="<span>Value changed from ",u+="'<span class='"+r.Ids.auditTrailChangesText.slice(1)+"'>"+c[f].OldValue+"</span>'",u+=" to ",h+="Field '"+f+"' was changed from '"+c[f].OldValue+"' to '"+c[f].NewValue+"'; "),u+="'<span class='"+r.Ids.auditTrailChangesText.slice(1)+"'>"+c[f].NewValue+"</span>'",u+="</span>",u+="</div>");o+="<td class='"+r.Ids.auditTrailChangesTd.slice(1)+"' title='"+i.escapeHtml(h.slice(0,-2))+"'>",o+=u,o+="</td>",o+="<td title='"+e[l].User+"'>",o+="<span>"+e[l].User+"</span>",o+="</td>";var p=i.datetime(e[l].Created);o+="<td title='"+p+"'>",o+="<span>"+p+"</span>",o+="</td>",o+="<td title='"+d+"'>",o+="<span>"+d+"</span>",o+="</td>",o+="</tr>"}o+="</tbody>",o+="</table>",n.show({content:o,title:"Audit Trail for "+a,width:"96",height:"96"})}(h)},error:function(e){CLog.e("AudtiTrail.getAuditTrail",e)}}).done(function(){void 0!==o.callback&&o.callback(h)})},this.updateAuditTrail=function(e,n,a){n=void 0!==n?n:{};var s=new SP.ClientContext(Constants.siteUrl),r=s.get_web().get_lists().getByTitle(t.auditTrailListName);for(var l in e)if(e.hasOwnProperty(l)){var c=new SP.ListItemCreationInformation,d=r.addItem(c),u={};for(var h in e[l].new)e[l].new.hasOwnProperty(h)&&(h.contains("date")&&(e[l].new[h]=i.date(e[l].new[h]),e[l].new[h]===i.date(t.defaultTime)&&(e[l].new[h]="N/A")),u[h]={},u[h].OldValue=e[l].old[h],u[h].NewValue=e[l].new[h]);d.set_item("ItemID",l),d.set_item("User",o.getCurrentUserId()),d.set_item("Changes",JSON.stringify(u)),n[l]=void 0!==n[l]?n[l]:"N/A",d.set_item("eLN",n[l]),d.update(),s.load(d)}s.executeQueryAsync(function(){void 0!==a&&a()},function(e,t){CLog.e("AuditTrail.updateAuditTrail","Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),DeleteItem=function(){function e(e){var t=NSMain.Constants,n=NSMain.PopupWindow,i=NSMain.BlockUI,o=NSMain.Toast,a=e.InventoryTable,s=e.AuditTrail,r=clone(e.settings);this.constructor=null,r.Ids={deleteContextMenu:".delete-context-menu",deleteConfirmPopupContentWrapper:"#delete-confirm-popup-window-content-wrapper",deleteConfirmPopupButtonWrapper:"#delete-confirm-popup-button-wrapper",deleteConfirmButton:"#delete-confirm-button",deleteCancelButton:"#delete-cancel-button"},r.rowIdPrefix="cell-line-id-";var l="",c={cancelDeleteButtonClickListener:function(){$("body").on("click",r.Ids.deleteCancelButton,function(e){n.hide()})},confirmDeleteButtonClickListener:function(){$("body").on("click",r.Ids.deleteConfirmButton,function(e){var c,d,u,h;c=l,u=new SP.ClientContext(Constants.siteUrl),(h=u.get_web().get_lists().getByTitle(t.itemsListName).getItemById(c)).set_item("Deleted","1"),h.update(),n.hide(),i.block(),u.executeQueryAsync(function(){i.unblock(),o.showToast({message:"Item deleted",duration:r.toastDuration});var e={};e[c]={old:{Deleted:"No"},new:{Deleted:"Yes"}},s.updateAuditTrail(e),l="",a.populateTable(),void 0!==d&&d()},function(e,t){o.showToast({message:"Error during deleting. Please refresh the page and try again.</br><span>Error message: <i>"+t.get_message()+"</i></span>",duration:0}),CLog.e("DeleteItem.deleteItem","Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})})},init:function(){this.cancelDeleteButtonClickListener(),this.confirmDeleteButtonClickListener()}};this.init=function(){$(function(){$.contextMenu({selector:r.Ids.deleteContextMenu,callback:function(e,t){var i;"cancel"!==e&&(l=$(this).closest("tr").attr("id").replace(r.rowIdPrefix,""),i="<div id='"+r.Ids.deleteConfirmPopupContentWrapper.slice(1)+"'>",i+="<p>Are you sure you want to delete item "+l+"?</p>",i+="<div id='"+r.Ids.deleteConfirmPopupButtonWrapper.slice(1)+"'>",i+="<a class='button' id='"+r.Ids.deleteConfirmButton.slice(1)+"'>Yes</a>",i+="<a class='button' id='"+r.Ids.deleteCancelButton.slice(1)+"'>Cancel</a>",i+="</div>",i+="</div>",n.show({title:"Are you sure?",content:i,height:"20",width:"30"}))},items:{delete:{name:"Delete",icon:"delete"},sep1:"---------",cancel:{name:"Cancel",icon:"quit"}}})}),c.init()}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),Filter=function(){function e(e){var t=NSMain.Constants,n=NSMain.MiscFunctions,i=NSMain.Toast,o=e.InventoryTable,a=e.Search,s=clone(e.settings),r=this;r.constructor=null;var l=s.fields;s.Ids={filterIcon:".filter-icon",filterPopup:".filter-popup",filterPopupHolderTr:"#filter-popup-holder-tr",opaque:".opaque",applyFilterButton:".apply-filter-button",clearFilterButton:".clear-filter-button",showDeletedItemsCheckboxHolder:"#show-deleted-items-checkbox-holder",showDeletedItemsCheckbox:"#show-deleted-items-checkbox"},s.thead={};var c=[],d={},u="",h="",f="",p={filterClickListener:function(){$("body").on("click",s.Ids.filterIcon,function(e){var t=$(this).closest("th").attr("field-name");y(),u===t?m.hide(t):(m.show(t),$(this).addClass(s.Ids.opaque.slice(1)))})},filterCheckboxChangeListener:function(){$(document).on("change",s.Ids.filterPopup+" input[type='checkbox']:not("+s.Ids.showDeletedItemsCheckbox+")",function(e){i.showToast({message:"Click 'Apply' to filter",duration:0})})},clearFilterButtonClickListener:function(){$("body").on("click",s.Ids.clearFilterButton,function(e){var t=$(this).closest(s.Ids.filterPopup).attr("field-name");h="",g.clear(t)})},applyFilterButtonClickListener:function(){$("body").on("click",s.Ids.applyFilterButton,function(e){var t=$(this).closest(s.Ids.filterPopup).attr("field-name");h=t,g.getCheckedItems(t)})},bodyClickListener:function(){$("body").on("click",function(e){var t=e.target.className.split(" ");t.contains(s.Ids.filterPopup.slice(1))||t.contains(s.Ids.filterIcon.slice(1))||$(e.target).closest(s.Ids.filterPopup).length>0||!$(s.Ids.filterPopup).is(":visible")||(m.hideAll(),y())})},showDeletedItemsCheckboxListener:function(){$(document).on("change",s.Ids.showDeletedItemsCheckbox,function(e){$(this).is(":checked")?a.showDeleted(!0):a.showDeleted(!1),o.populateTable()})},init:function(){this.filterClickListener(),this.filterCheckboxChangeListener(),this.clearFilterButtonClickListener(),this.applyFilterButtonClickListener(),this.bodyClickListener(),this.showDeletedItemsCheckboxListener()}},m={show:function(e){$(s.Ids.filterPopupHolderTr).find(s.Ids.filterPopup).fadeOut(t.fadeDuration),$(s.Ids.filterPopupHolderTr).find(s.Ids.filterPopup+"[field-name='"+e+"']").fadeIn(t.fadeDuration).promise().done(function(){!0,"id"===(u=e).toLowerCase()&&a.showDeleted()&&$(s.Ids.showDeletedItemsCheckbox).attr("checked",!0)})},hide:function(e){$(s.Ids.filterPopupHolderTr).find(s.Ids.filterPopup+"[field-name='"+e+"']").fadeOut(t.fadeDuration).promise().done(function(){u="",!1}),i.hideToast()},hideAll:function(){$(s.Ids.filterPopupHolderTr).find(s.Ids.filterPopup).fadeOut(t.fadeDuration).promise().done(function(){u="",!1}),i.hideToast()}},g={prepare:function(e){var t="<div class='pretty p-default p-curve' title='"+e+"'>";return t+="<input type='checkbox' filter-value='"+e+"'>",t+="<div class='state p-primary-o'>",t+="<label>"+e+"</label>",t+="</div>",t+="</div>"},check:function(){for(var e=c.length,t=0;t<e;t++){var n=c[t],i=d[n];for(var o in i)i.hasOwnProperty(o)&&$(document).find(s.Ids.filterPopup+"[field-name='"+n+"']").find("input[filter-value='"+i[o]+"']").prop("checked",!0)}},clear:function(e){$(s.Ids.filterPopup+"[field-name='"+e+"']").find("input[type='checkbox']:not("+s.Ids.showDeletedItemsCheckbox+")").prop("checked",!1),d[e]=[],c.remove(e),g.getCheckedItems(e)},getCheckedItems:function(e){void 0===d[e]&&(d[e]=[]),$(document).find(s.Ids.filterPopup+"[field-name='"+e+"']").find("input[type='checkbox']:not("+s.Ids.showDeletedItemsCheckbox+")").each(function(){var t=$(this).attr("filter-value"),n=d[e].indexOf(t);!$(this).is(":checked")||n>-1?!$(this).is(":checked")&&n>-1&&d[e].remove(t):d[e].push(t)}),0===d[e].length?(delete d[e],c.remove(e)):c.push(e),y(),function(){var e="";if(0!==c.length){for(var n in e+="(",d)if(d.hasOwnProperty(n)){var i=d[n],s=i.length;e+="(";for(var r=0;r<s;r++)n.contains("date")?"N/A"==i[r]?e+="("+n+" le datetime'"+t.defaultTime+"') or ":e+=a.prepareDateQuery(i[r],n):e+="("+n+" eq '"+i[r]+"') or ";e=e.slice(0,-4),e+=") and "}e=e.slice(0,-5),e+=")"}f=e,m.hideAll(),o.populateTable()}()}},v={init:function(){s.thead.append("<tr id='"+s.Ids.filterPopupHolderTr.slice(1)+"'></tr>"),this.refresh()},refresh:function(e){var t=this;e=void 0!==e?e:h;for(var n=l.length,i=0;i<n;i++)l[i]!==e&&(t.values[l[i]]=[]);!function e(n){var i={success:function(n,i){void 0!==i&&e(i),function(e){t.saveValues(e),$(s.Ids.filterPopupHolderTr).html(t.prepareFilterCells()),g.check(),y()}(n)}};void 0!==n&&(i.nextQuery=n);o.getData(i)}(),u="",!1},saveValues:function(e){for(var t=l.length,n="",i=0,o=e.length;i<o;i++)for(var a=e[i],s=0;s<t;s++)n=l[s],void 0===this.values[n]&&(this.values[n]=[]),this.values[n].contains(a[n])||this.values[n].push(a[n]);for(var r=0;r<t;r++)"id"===(n=l[r]).toLowerCase()?this.values[n].sortNumbers():this.values[n].sort()},prepareFilterCells:function(){for(var e=l.length,i="",o=0;o<e;o++){var a=l[o];if(i+="<th>",i+="<div class='"+s.Ids.filterPopup.slice(1)+"' field-name='"+a+"'>",i+="<div>",i+="<a class='button "+s.Ids.applyFilterButton.slice(1)+"'>Apply</a>",i+="<a class='button "+s.Ids.clearFilterButton.slice(1)+"'>Clear</a>",i+="</div>","id"===a.toLowerCase()){var r="<div class='pretty p-default p-curve' id='"+s.Ids.showDeletedItemsCheckboxHolder.slice(1)+"' title='Show Deleted Items'>";r+="<input type='checkbox' id='"+s.Ids.showDeletedItemsCheckbox.slice(1)+"' filter-value='Show Deleted Items'>",r+="<div class='state p-primary-o'>",r+="<label>Show Deleted Items</label>",r+="</div>",i+=r+="</div>"}i+="<ul>";for(var c=this.values[a].length,d=!1,u=0;u<c;u++)a.contains("date")?null!==this.values[a][u]&&this.values[a][u]!==t.defaultTime?i+="<li>"+g.prepare(n.date(this.values[a][u]))+"</li>":d||(d=!0,i+="<li>"+g.prepare("N/A")+"</li>"):i+="<li>"+g.prepare(this.values[a][u])+"</li>";i+="</ul>",i+="</div>",i+="</th>"}return i},values:{}};function y(){$(s.Ids.filterIcon).removeClass(s.Ids.opaque.slice(1));for(var e=c.length,t=0;t<e;t++)$(s.Ids.filterIcon).closest("tr").find("th[field-name='"+c[t]+"']").find(s.Ids.filterIcon).addClass(s.Ids.opaque.slice(1))}r.queryString=function(){return f},r.refresh=function(){v.refresh()},r.solveCircularDependencies=function(){var e,t,n,i=arguments[0];for(n in r.setInventoryTable=function(e){o=e,r.InventoryTable=null},i)if(i.hasOwnProperty(n)){e="set"+n,t=i[n];try{r[e](t)}catch(e){CLog.e("Filter.solveCircularDependencies",e)}}},r.init=function(e){s.thead=e,s.thead.find("tr:first-child").find("th").find(o.theadTextHtmlClass()).parent().each(function(){var e="<span class='"+s.Ids.filterIcon.slice(1)+"'></span>";$(this).append(e)}),v.init(),p.init()}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),InventoryTable=function(){function e(e){var t=NSMain.Constants,n=NSMain.BlockUI,i=NSMain.Spinner,o=NSMain.PopupWindow,a=NSMain.MiscFunctions,s=e.ItemUpdates,r=e.Search,l=e.NewItem,c=e.AuditTrail,d=e.Filter,u=e.Sort,h=e.DeleteItem,f=clone(e.settings),p=this;p.constructor=null;var m=!1,g=f.fields,v="";f.Ids={inventoryTable:"#inventory-table",theadTextWrapper:".inventory-table-thead-text-wrapper",theadText:".inventory-table-thead-text",deletedItemTd:".deleted-item-td",deletedItemTr:".deleted-item-tr",deleteContextMenu:".delete-context-menu"},f.rowIdPrefix="cell-line-id-";var y="",b={inventoryTableInputFocusListener:function(){$("body").on("focus",f.Ids.inventoryTable+" td input",function(e){$(this).closest("tr").attr("id")!==l.rowId()&&s.initialValues($(this)),m=!0})},inventoryTableInputKeyPressListener:function(){$("body").on("keyup",f.Ids.inventoryTable+" td input",function(e){$(this).closest("tr").attr("id")!==l.rowId()&&(s.focusedItemAction($(this)),13==e.keyCode&&(s.itemsChanged()?s.updateItems():l.isNewItemRowVisible()&&l.saveNewItem()))})},inventoryTableInputBlurListener:function(){$("body").on("blur",f.Ids.inventoryTable+" td input",function(e){m=!1})},inventoryTableIdClickListener:function(){$("body").on("click",f.Ids.inventoryTable+" tbody tr td:first-child",function(e){$(this).closest("tr").attr("id")!==l.rowId()&&c.getAuditTrail($(this).closest("tr").attr("id").replace(f.rowIdPrefix,""))})},bodyKeyPressListener:function(){$("body").on("keyup",function(e){o.isVisible()||(m||13!=e.keyCode||(s.itemsChanged()?s.updateItems():l.isNewItemRowVisible()&&l.saveNewItem()),27==e.keyCode&&l.isNewItemRowVisible()&&(l.removeNewItemRow(),s.itemsChanged()&&setTimeout(function(){s.showUnsavedChangesToast()},2*t.fadeDuration)))})},inventoryTableScrollToBottomListener:function(){$(f.Ids.inventoryTable+" tbody").off("scroll"),$(f.Ids.inventoryTable+" tbody").scroll(function(e){this.scrollHeight-this.scrollTop===this.clientHeight&&""!==v&&(i.show(),p.getData({nextQuery:v,success:function(e,t){v="",void 0!==t&&(v=t);for(var n={},i=g.length,o=0;o<i;o++)"ID"===g[o]?n[g[o]]="a":n[g[o]]="input";y.html(y.html()+w(e,n)),b.inventoryTableScrollToBottomListener(),a.pikaday.init()},done:function(){i.hide()}}))})},init:function(){this.inventoryTableInputFocusListener(),this.inventoryTableInputKeyPressListener(),this.inventoryTableInputBlurListener(),this.bodyKeyPressListener(),this.inventoryTableIdClickListener(),this.inventoryTableScrollToBottomListener()}};function w(e,n){for(var i="",o=0,s=e.length;o<s;o++){i+="<tr id="+f.rowIdPrefix+e[o].Id;var r=1==e[o].Deleted;for(var l in r&&(i+=" class='"+f.Ids.deletedItemTr.slice(1)+"'"),i+=">",n)if(n.hasOwnProperty(l)){var c={value:e[o][l],field:l};l.contains("date")&&a.date(e[o][l])===a.date(t.defaultTime)&&(e[o][l]=null,c.value=e[o][l]),r?(c.title="(This item was deleted and cannot be edited)","id"===l.toLowerCase()?c.type="a":c.class=f.Ids.deletedItemTd.slice(1)):(c.type=n[l],l.contains("date")&&(c.class="datepicker"),"id"===l.toLowerCase()&&(c.class=f.Ids.deleteContextMenu.slice(1))),i+=p.prepareTableCell(c)}i+="</tr>"}return i}function I(e){e=void 0!==e?e:{};for(var t="?$select=",n=g.length,i=0;i<n;i++)t+=g[i]+",";t+="Deleted";var o="";void 0!==e.searchQuery?o+=e.searchQuery:""!==r.queryString()&&(o+=r.queryString());var a="";return void 0!==e.filterQuery?a+=e.filterQuery:""!==d.queryString()&&(a+=d.queryString()),""!==o&&""!==a?t+="&$filter=("+o+" and "+a+")":""===o&&""!==a?t+="&$filter=("+a+")":""!==o&&""===a&&(t+="&$filter=("+o+")"),void 0!==e.sortQuery?t+=e.sortQuery:""!==u.sortQueryString()?t+=u.sortQueryString():t+="&$orderby=ID desc",void 0!==e.paginationQuery&&(t+=e.paginationQuery),t}p.prepareTableCell=function(e){e.type=void 0!==e.type?e.type:"",e.id=void 0!==e.id?e.id:"",e.class=void 0!==e.class?e.class:"",e.field=void 0!==e.field?e.field:"",e.title=void 0!==e.title?e.title:"",e.value=null!==e.value?e.value:"",e.value=a.escapeHtml(e.value);var t=e.value,n="<td";return""!==e.field&&(n+=" field-name="+e.field),""!==e.id&&(n+=" id="+e.id),""!==e.class&&(n+=" class="+e.class),""!==e.title&&(t=e.value+" "+e.title),e.field.contains("date")&&(e.value=a.date(e.value)),n+=">",""===e.type?n+="<span title='"+t+"'>"+e.value:"input"===e.type?n+="<input value='"+e.value+"' title='"+t+"'/>":n+="<"+e.type+" title='"+t+"'>"+e.value+"</"+e.type+">",n+="</td>"},p.populateTable=function(e){(e=void 0!==e?e:{}).blockUI=void 0===e.blockUI||e.blockUI;var t=I({searchQuery:e.searchQuery,sortQuery:e.sortQuery,filterQuery:e.filterQuery,paginationQuery:"&$top=50"});e.blockUI&&n.block(500),p.getData({query:t,success:function(e,t){v="",void 0!==t&&(v=t);for(var n={},i=g.length,o=0;o<i;o++)"ID"===g[o]?n[g[o]]="a":n[g[o]]="input";(y=$(f.Ids.inventoryTable).find("tbody")).html(w(e,n)),b.inventoryTableScrollToBottomListener(),a.pikaday.init(),d.refresh()},done:function(){n.unblock(),void 0!==e.callback&&e.callback()}})},p.getData=function(e){var n="",i="_api/web/lists/getbytitle('"+t.itemsListName+"')/items";void 0===e.query&&(e.query=I()),n=void 0!==e.nextQuery?e.nextQuery:t.siteUrl+i+e.query,$.ajax({url:n,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:function(t){try{void 0!==t.d.__next?e.success(t.d.results,t.d.__next):e.success(t.d.results)}catch(e){CLog.catch("InventoryTable.getData successCallback",e,!0)}},error:function(e){CLog.e("InventoryTable.getData",e)}}).done(function(){try{e.done()}catch(e){CLog.catch("InventoryTable.getData doneCallback",e)}})},p.body=function(){return y},p.id=function(){return f.Ids.inventoryTable},p.rowIdPrefix=function(){return f.rowIdPrefix},p.theadTextHtmlClass=function(){return f.Ids.theadText},p.solveCircularDependencies=function(){var e,t,n,i=arguments[0];for(n in p.setNewItem=function(e){l=e,p.setNewItem=null},p.setItemUpdates=function(e){s=e,p.setItemUpdates=null},p.setDeleteItem=function(e){h=e,p.setDeleteItem=null},i)if(i.hasOwnProperty(n)){e="set"+n,t=i[n];try{p[e](t)}catch(e){CLog.e("InventoryTable.solveCircularDependencies",e)}}},p.init=function(){!function(){for(var e=g.length,t="<tr>",n=0;n<e;n++)t+="<th field-name='"+g[n]+"'>",t+="<span class='"+f.Ids.theadTextWrapper.slice(1)+"'>",t+="<span class='"+f.Ids.theadText.slice(1)+"'>"+g[n].toSentenceCaseWithSpaces()+"</span>",t+="</span></th>";t+="<th></th>",t+="</tr>";var i=$(f.Ids.inventoryTable).find("thead");i.html(t+i.html()),d.init(i),u.init(i)}(),b.init(),h.init()}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),ItemUpdates=function(){function e(e){var t=NSMain.Constants,n=NSMain.MiscFunctions,i=NSMain.Toast,o=NSMain.BlockUI,a=NSMain.PopupWindow,s=e.NewItem,r=e.AuditTrail,l=e.InventoryTable,c=clone(e.settings),d=this;d.constructor=null,c.Ids={highlighted:".highlighted"},c.elnPopup={Ids:{contentWrapper:"#eln-number-request-popup-contents"},inputPlaceholder:"Please enter the eLN number where you used the cell line",title:"Quantity Changed - Please Enter eLN Reference"};var u={currentValue:"",hasChanged:!1,id:"",fieldName:""},h={},f={},p=!1,m=[],g={},v=!1,y=!1,b={elnReferencePopupSaveButtonClickListener:function(){$("body").on("click",c.elnPopup.Ids.contentWrapper+" .button",function(e){w()})},elnReferencePopupTableInputKeyPressListener:function(){$("body").on("keyup",c.elnPopup.Ids.contentWrapper+" table tr td input",function(e){13==e.keyCode&&w()})},inventoryTableDatepickerChangeListener:function(){$("body").on("change",l.id()+" .datepicker input",function(e){$(this).closest("tr").attr("id")!==s.rowId()&&d.focusedItemAction($(this))})},init:function(){this.elnReferencePopupSaveButtonClickListener(),this.elnReferencePopupTableInputKeyPressListener(),this.inventoryTableDatepickerChangeListener()}};function w(){y=!1,v=!1,$(c.elnPopup.Ids.contentWrapper+" table tr").each(function(){var e=$(this).find("td:first-child").html(),t=$(this).find("td:last-child input").val();""==t||t==c.elnPopup.inputPlaceholder?(y=!0,i.showToast({message:"Please fill all the fields",shake:"true",callback:function(){d.showUnsavedChangesToast()}})):g[e]=t}).promise().done(function(){y||(v=!0,a.hide())})}function I(e){u.id=e.closest("tr").attr("id").slice(l.rowIdPrefix().length),u.fieldName=e.closest("td").attr("field-name"),u.currentValue=e.val().trim()}var x={add:function(e,t){$("#"+l.rowIdPrefix()+e).find("td[field-name='"+t+"']").find("input").addClass(c.Ids.highlighted.slice(1))},remove:function(e,t){$("#"+l.rowIdPrefix()+e).find("td[field-name='"+t+"']").find("input").removeClass(c.Ids.highlighted.slice(1))},clearAll:function(){$(l.id()).find("input").removeClass(c.Ids.highlighted.slice(1))}};function k(){if(s.isNewItemRowVisible()){var e=c.toastDuration+1.1*t.fadeDuration;s.showAddNewItemToast(e),l.body().find("tr:first-child td:first-child input").focus()}}d.itemsChanged=function(e){if(void 0===e)return u.hasChanged;!1===e&&x.clearAll(),u.hasChanged=e},d.currentValue=function(e){if(void 0===e)return u.currentValue;u.currentValue=e},d.initialValues=function(e){I(e),void 0!==f[u.id]&&void 0!==f[u.id].old&&void 0!==f[u.id].old[u.fieldName]||(h[u.id]=u.currentValue)},d.focusedItemAction=function(e){I(e),void 0===f[u.id]&&(f[u.id]={},f[u.id].new={},f[u.id].old={},f[u.id].old[u.fieldName]=h[u.id]),void 0===f[u.id].old[u.fieldName]&&(f[u.id].old[u.fieldName]=h[u.id]),f[u.id].new[u.fieldName]=u.currentValue,function(){for(var e in f)if(f.hasOwnProperty(e)){for(var i in f[e].new)if(f[e].new.hasOwnProperty(i))if(f[e].new[i]===f[e].old[i])delete f[e].new[i],delete f[e].old[i],x.remove(e,i);else if(x.add(e,i),i.contains("date")){var o=new Date(f[e].new[i]);"Invalid Date"===o||isNaN(o)?f[e].new[i]=t.defaultTime:n.date(f[e].new[i])===n.date(f[e].old[i])&&(delete f[e].new[i],delete f[e].old[i],x.remove(e,i))}jQuery.isEmptyObject(f[e].new)&&delete f[e],jQuery.isEmptyObject(f)?d.itemsChanged(!1):d.itemsChanged(!0)}}(),d.itemsChanged()?d.showUnsavedChangesToast():(i.hideToast(),k())},d.showUnsavedChangesToast=function(){i.showToast({message:"Press 'Enter' to save changes",duration:0})},d.updateItems=function(e){p=!1,m=[];var n=new SP.ClientContext(Constants.siteUrl),s=n.get_web().get_lists().getByTitle(t.itemsListName),y=!1,b="<div id='"+c.elnPopup.Ids.contentWrapper.slice(1)+"'>";for(var w in b+="<table class='"+t.Ids.scrollableTable.slice(1)+"'>",b+="<thead>",b+="<tr>",b+="<th>Item ID</th>",b+="<th>eLN</th>",b+="<th></th>",b+="</tr>",b+="<tr class='shadow'><th></th></tr>",b+="</thead>",b+="<tbody>",f)if(f.hasOwnProperty(w)){var I=s.getItemById(w);for(var x in f[w].new)if(f[w].new.hasOwnProperty(x))if(f[w].new[x]===f[w].old[x])delete f[w].new[x],delete f[w].old[x];else{if(x.contains("date")){var C=new Date(f[w].new[x]);("Invalid Date"===C||isNaN(C))&&(f[w].new[x]=t.defaultTime)}""!==f[w].new[x]?I.set_item(x,f[w].new[x]):(p=!0,m.push([w,x]))}I.update(),b+="<tr>",b+="<td>"+w+"</td>",b+="<td><input type='text' placeholder='"+c.elnPopup.inputPlaceholder+"'></td>",b+="</tr>",void 0!==f[w].new.Quantity&&(y=!0),jQuery.isEmptyObject(f[w].new)&&delete f[w]}if(b+="</tbody>",b+="</table>",b+="<a class='button'>Save</a>",b+="</div>",p){w=m[0][0];var D=m[0][1];$("#"+l.rowIdPrefix()+w).find("td[field-name='"+D+"']").find("input").focus(),i.showToast({message:"Please fill all the fields. Values cannot be empty.",shake:"true",callback:function(){d.showUnsavedChangesToast()}})}else y?function(e,t){a.show({content:e,title:c.elnPopup.title,width:"50",height:"50"});var n=setInterval(function(){v&&(clearInterval(n),t())},200)}(b,T):T();function T(){o.block(),n.executeQueryAsync(function(){o.unblock(),i.showToast({message:"Changes saved",duration:c.toastDuration}),d.itemsChanged(!1),h[u.id]=u.currentValue,r.updateAuditTrail(JSON.parse(JSON.stringify(f)),JSON.parse(JSON.stringify(g))),f={},g={},y=!1,v=!1,k(),void 0!==e&&e()},function(e,t){i.showToast({message:"Error during saving. Please refresh the page and try again.</br><span>Error message: <i>"+t.get_message()+"</i></span>",duration:0}),CLog.e("ItemUpdates.updateItem","Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}},d.init=function(){b.init()}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),NewItem=function(){function e(e){var t=NSMain.Constants,n=NSMain.Toast,i=NSMain.BlockUI,o=NSMain.MiscFunctions,a=e.Search,s=e.InventoryTable,r=e.AuditTrail,l=clone(e.settings),c=this;c.constructor=null,l.Ids={addNewItemButton:"#add-new-button",addNewItemRow:"#add-new-item-row",theadBlockTr:"#thead-block-tr"},l.addNewItemRowInputPrefix="new-item-",l.headerBlockWarningText="You cannot sort or use filters while adding a new item";var d=l.fields,u=!1,h="",f="",p="",m={addNewItemButtonClickListener:function(){$(l.Ids.addNewItemButton).on("click",function(){u?c.saveNewItem():($(this).html("Save"),function(){if((p=$(s.id()).find("thead")).append("<tr id='"+l.Ids.theadBlockTr.slice(1)+"' data-balloon-pos='up' data-balloon='"+l.headerBlockWarningText+"'><th></th></tr>"),f=setInterval(function(){u&&!$(n.id()).is(":visible")?c.showAddNewItemToast():u||clearInterval(f)},4e3),!u){var e="<tr id='"+l.Ids.addNewItemRow.slice(1)+"'>";e+=s.prepareTableCell({value:"",type:"",id:""});for(var t=d.length,i=0;i<t;i++)if("id"!==d[i].toLowerCase()){var r=l.addNewItemRowInputPrefix+d[i].toLowerCaseWithDashes(),h={value:"",type:"input",id:r};d[i].contains("date")&&(h.class="datepicker"),e+=s.prepareTableCell(h)}e+="</tr>",s.body().html(e+s.body().html()),s.body().find("tr:first-child td:nth-child(2) input").focus(),o.pikaday.init(),u=!0}c.showAddNewItemToast(),a.disable("You cannot use search while adding a new item")}())})},newItemRowKeyPressListener:function(){$("body").on("keyup",l.Ids.addNewItemRow+" td input",function(e){13==e.keyCode&&u&&c.saveNewItem()})},init:function(){this.addNewItemButtonClickListener(),this.newItemRowKeyPressListener()}};c.isNewItemRowVisible=function(){return u},c.removeNewItemRow=function(){$(l.Ids.addNewItemRow).remove(),p.find(l.Ids.theadBlockTr).remove(),u=!1,n.hideToast(),a.enable(),$(l.Ids.addNewItemButton).html("Add New")},c.showAddNewItemToast=function(e){e=void 0!==e?e:0,setTimeout(function(){n.showToast({message:"Press 'Enter' to save new item</br>'Esc' to cancel",duration:0})},e)},c.saveNewItem=function(){var e=function(){for(var e={},t=d.length,n=0;n<t;n++)if("id"!==d[n].toLowerCase()){var i=l.addNewItemRowInputPrefix+d[n].toLowerCaseWithDashes();e[d[n]]=$("#"+i).find("input").val()}return e}(),o={old:{},new:{}};for(var f in h="",e)e.hasOwnProperty(f)&&""===e[f]&&""===h&&(h=l.addNewItemRowInputPrefix+f.toLowerCaseWithDashes());if(""!==h)s.body().find("#"+h).find("input").focus(),n.showToast({message:"Please fill all the fields",shake:"true",callback:function(){c.showAddNewItemToast()}});else{i.block(500);for(var m=new SP.ClientContext(Constants.siteUrl),g=m.get_web().get_lists().getByTitle(t.itemsListName),v=new SP.ListItemCreationInformation,y=g.addItem(v),b=d.length,w=0;w<b;w++)if("id"!==d[w].toLowerCase()){if(d[w].contains("date")){var I=new Date(e[d[w]]);("Invalid Date"===I||isNaN(I))&&(e[d[w]]=t.defaultTime)}o.old[d[w]]="",o.new[d[w]]=e[d[w]],y.set_item(d[w],e[d[w]])}y.update(),m.load(y),m.executeQueryAsync(function(){u=!1,n.showToast({message:"New item saved",duration:l.toastDuration}),s.populateTable(),i.unblock(),a.enable(),$(l.Ids.addNewItemButton).html("Add New"),p.find(l.Ids.theadBlockTr).remove();var e={};e[y.get_item("ID")]=o,r.updateAuditTrail(e)},function(e,t){i.unblock(),a.enable(),CLog.e("NewItem.saveNewItem","Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}},c.rowId=function(){return l.Ids.addNewItemRow.slice(1)},c.init=function(){m.init()}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),Search=function(){function e(e){var t=NSMain.Constants,n=NSMain.MiscFunctions,i=(e.NewItem,e.InventoryTable),o=clone(e.settings),a=this;a.constructor=null,o.Ids={searchInput:"#search-input",searchGrayOut:"#search-elements-grayout",searchButton:"#search-button",searchCancelButton:"#search-cancel-button",checkboxHolder:"#search-checkbox-holder",createdCheckbox:"#search-created-checkbox",modifiedCheckbox:"#search-modified-checkbox"};var s=o.fields,r="",l="",c="",d="",u=!1,h=!1,f=!1,p="(Deleted eq 0)",m=!1,g={searchInputKeyPressListener:function(){$("body").on("keyup",o.Ids.searchInput,function(e){if(13==e.keyCode)return e.preventDefault?e.preventDefault():e.returnValue=!1,v(l.val()),!1})},searchButtonClickListener:function(){$("body").on("click",o.Ids.searchButton,function(){v(l.val())})},searchCancelClickListener:function(){$("body").on("click",o.Ids.searchCancelButton,function(){p=m?"((Deleted eq 1) or (Deleted eq 0))":"(Deleted eq 0)",i.populateTable({callback:function(){l.val(""),y(),c.fadeOut(200)}})})},searchInputBlurListener:function(){$("body").on("blur",o.Ids.searchInput,function(e){""===p&&"(Deleted eq 0)"===p||""!=l.val()||b(d)})},searchCheckboxListener:function(){$(document).on("change",o.Ids.createdCheckbox,function(e){$(o.Ids.checkboxHolder).is(":visible")&&(u=!!$(this).is(":checked"),v(l.val()))}),$(document).on("change",o.Ids.modifiedCheckbox,function(e){$(o.Ids.checkboxHolder).is(":visible")&&(h=!!$(this).is(":checked"),v(l.val()))})},init:function(){this.searchInputKeyPressListener(),this.searchButtonClickListener(),this.searchCancelClickListener(),this.searchInputBlurListener(),this.searchCheckboxListener()}};function v(e){if(f=!1,void 0!==e&&""!==e){var r="(";if("deleted"===e.toLowerCase()||'"show deleted"'===e.toLowerCase())r+="Deleted eq 1)",i.populateTable({searchQuery:r,callback:function(){c.fadeIn(200),p=r,d=e}});else{var l=e.match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g);l.contains("deleted")||l.contains("Deleted")||l.contains("DELETED")||l.contains('"show deleted"')||l.contains('"Show Deleted"')||l.contains('"Show deleted"')||l.contains('"SHOW DELETED"')||(r+="(Deleted eq 0) and ");for(var g=l.length,v=s.length,b=0;b<g;b++){l[b]=l[b].replace(/"/g,""),("deleted"===l[b].toLowerCase()||"show deleted"===l[b].toLowerCase()||m)&&(r+="((Deleted eq 1) or (Deleted eq 0)) or "),r+="(";for(var w=0;w<v;w++)s[w].contains("date")&&n.isDate(l[b])?(r+=a.prepareDateQuery(l[b],s[w]),u&&(r+=a.prepareDateQuery(l[b],"Created")),h&&(r+=a.prepareDateQuery(l[b],"Created"))):r+="(substringof('"+l[b]+"',"+s[w]+")) or ";r=r.slice(0,-4),r+=") and "}r=r.slice(0,-5),p=r+=")",i.populateTable({searchQuery:r,callback:function(){c.fadeIn(200),p=r,d=e,f?$(o.Ids.checkboxHolder).fadeIn(t.fadeDuration):y()}})}}else i.populateTable({searchQuery:"",callback:function(){p=m?"((Deleted eq 1) or (Deleted eq 0))":"(Deleted eq 0)",d="",c.fadeOut(200)}})}function y(){$(o.Ids.checkboxHolder).fadeOut(t.fadeDuration).promise().done(function(){$(o.Ids.checkboxHolder).find("input:checkbox").prop("checked",!1)}),u=!1,h=!1}function b(e){l.val(e)}a.disable=function(e){void 0!==e&&r.attr("data-balloon",e),r.fadeIn(200)},a.enable=function(){r.removeAttr("data-balloon"),r.fadeOut(200)},a.queryString=function(){return p},a.prepareDateQuery=function(e,t){var i="",o=new Date(e).fixUTCDateOffset(),a=o.getDate().toString(),s=o.getMonth().toString(),r=o.getFullYear().toString();if(!isNaN(a)&&!isNaN(s)&&!isNaN(r)){var l=a+" "+o.getMonthNameShort()+" "+r+" 00:00:00 GMT-0000";o=new Date(l);var c=new Date(l).toISOString(),d=o.addDays(365).toISOString();1!=a?d=o.addDays(1).toISOString():(0!=s&&1==a||0==s&&1!=a)&&(d=o.addDays(n.daysInMonth(s+1,r)).toISOString()),i+="(",i+="("+t+" ge datetime'"+c+"') and ",i+="("+t+" lt datetime'"+d+"')",i+=") or ",f=!0}return i},a.showDeleted=function(e){if(void 0===e)return m;(m=e)?(p="((Deleted eq 1) or (Deleted eq 0))",d="",b(""),y(),c.fadeOut(200)):(p="(Deleted eq 0)",d="",b(""),y(),c.fadeOut(200))},a.solveCircularDependencies=function(){var e,t,n,o=arguments[0];for(n in a.setNewItem=function(e){e,a.setNewItem=null},a.setInventoryTable=function(e){i=e,a.InventoryTable=null},o)if(o.hasOwnProperty(n)){e="set"+n,t=o[n];try{a[e](t)}catch(e){CLog.e("Search.solveCircularDependencies",e)}}},a.init=function(){g.init(),r=$(o.Ids.searchGrayOut),l=$(o.Ids.searchInput),c=$(o.Ids.searchCancelButton)}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),Sort=function(){function e(e){var t=NSMain.Constants,n=e.InventoryTable,i=clone(e.settings),o=this;o.constructor=null;i.fields;i.Ids={sortArrow:".sort-arrow",clearSortButton:"#clear-sort-button"},i.thead={};var a={field:"",order:"asc",query:"",clear:!0},s={sortClickListener:function(){$("body").on("click",n.theadTextHtmlClass()+", "+i.Ids.sortArrow,function(e){r($(this).closest("th").attr("field-name")),n.populateTable()})},clearSortingButtonClickListener:function(){$("body").on("click",i.Ids.clearSortButton,function(e){r(""),n.populateTable()})},init:function(){this.sortClickListener(),this.clearSortingButtonClickListener()}};function r(e){a.clear=!1,l.show(),""===e?(e="ID",a.clear=!0,l.hide(),a.order="desc"):e!==a.field?a.order="asc":a.order="asc"===a.order?"desc":"asc",a.field=e,a.query="&$orderby="+e+" "+a.order,function(){if(i.thead.find(i.Ids.sortArrow).hide(),i.thead.find(i.Ids.sortArrow).parent().removeClass(t.Ids.underlined.slice(1)),!a.clear){var e=i.thead.find("th[field-name='"+a.field+"']").find(i.Ids.sortArrow);e.parent().addClass(t.Ids.underlined.slice(1)),"asc"===a.order?e.html("&#9650;"):e.html("&#9660;"),e.show()}}()}var l={init:function(){i.thead.closest("table").parent().append("<a id='"+i.Ids.clearSortButton.slice(1)+"'>Clear Sorting</a>")},show:function(){$(i.Ids.clearSortButton).show()},hide:function(){$(i.Ids.clearSortButton).hide()}};o.sortQueryString=function(){return a.query},o.solveCircularDependencies=function(){var e,t,i,a=arguments[0];for(i in o.setInventoryTable=function(e){n=e,o.InventoryTable=null},a)if(a.hasOwnProperty(i)){e="set"+i,t=a[i];try{o[e](t)}catch(e){CLog.e("Sort.solveCircularDependencies",e)}}},o.init=function(e){i.thead=e,i.thead.find("tr:first-child").find("th").find(n.theadTextHtmlClass()).parent().each(function(){var e="<span title='Sort' class='"+i.Ids.sortArrow.slice(1)+"'>&#9660;</span>";$(this).append(e)}),l.init(),s.init()}}var t=null;return{getInstance:function(n){return null===t&&(t=new e(n)),t}}}(),console.log("Version:","2.7.1434"),CLog.dev=!1,CLog.hideCaught=!0;